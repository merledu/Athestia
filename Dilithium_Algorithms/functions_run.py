from Dilithium_Key import *

q = 8380417
rows_k = 8
cols_l = 7
coefficients_per_polynomial = 256
eta = 2
η = 2
d = 13


#---------------------------------------------------- KEY ----------------------------------------------------#
def IntegerToBytes(x, α):
    # y = bytearray(α) 
    y = [0] * α
    x_prime = x

    for i in range(α):
        y[i] = x_prime % 256
        x_prime = x_prime // 256
    # return bytes(y)
    # return y
    return bytearray(y)

x = 56758491223782255116706065660090661450792979282557094739072532684472550750973
α = 32 
byte_string = IntegerToBytes(x, α)
# print("Byte string:", byte_string)



import math 
def bits_to_bytes(y):                                                       
    alpha = len(y)
    # print(alpha)
    z = [0] * math.ceil(alpha / 8)   #The byte string has a length of ⌈alpha/8⌉, math.ceil() method rounds a number to the nearest integer

    for i in range(alpha):
        z[i // 8] += y[i] * (2 ** (i % 8))   #Adds the bit y[i] to the appropriate position in the byte string z. The byte index is ⌊i/8⌋, 
                                             #and y[i] is multiplied by 2^(i mod 8) to shift the bit into the correct position within the byte.
    return (z)  

y = [1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1]  # Example bit string
z = bits_to_bytes(y)
# print(z)



def IntegerToBits(x, α):
    x_prime = x
    y = [0] * α 

    for i in range(α):
        y[i] = x_prime % 2  #This operation extracts the least significant bit (LSB) of x. Modulo gives remainder
        x_prime = x_prime // 2    #This operation effectively moves to the next bit in x. (equivalent to a right shift). Division gives quotient 
    return y
x = 4
alpha = 3  # Number of bits (we want 8 bits in this example)
bit_string = IntegerToBits(x, alpha)
# print("Bit string:", bit_string)



def BitsToInteger(y, α):
    x = 0
    for i in range(1, α+1):
        x = 2*x + y[α - i]  # Access the bit in little-endian order
    return x

# Example usage:
bit_string = [1, 0, 1, 1]  # Represents the bit string 1101 (in little-endian order)
length = len(bit_string)    # Length of the bit string
result = BitsToInteger(bit_string, length)
# print(f"The integer value of the bit string {bit_string} is: {result}")



def BitRev8(m):
    b = IntegerToBits(m, 8)
    brev = [0] * 8

    for i in range(8):
        brev[i] = b[7 - i]  # Reverse the order of bits

    # Step 6: Convert the reversed bit array back to an integer
    r = BitsToInteger(brev, 8)

    return r

m = 13  # For example, the byte '13' in binary is '00001101'
result = BitRev8(m)
# print(f"Original byte: {m} -> Reversed byte: {result}")


def montgomery_reduce(a):
    QINV = 58728449  
    t = ((a % (2**32)) * QINV) % (2**32)
    r = (a - t * q) // (2**32)
    return r



def bitlen(x):     # Calculate the bit length of a positive integer x using a loop
    length = 0
    while x > 0:
        x = x // 2
        length += 1
    return length

x = 32
bits = bitlen(x)
# print("Bits:", bits)



def SimpleBitPack(w, b):
    z = []
    for i in range(256):  # Since w has 256 coefficients
        # Step 3: z ← z || IntegerToBits(w_i, bitlen b)
        z += IntegerToBits(w[i], bitlen(b))  # Append bit representation of w_i to z
    # print(len(z))       #2560
    # print(z)

    return bits_to_bytes(z)
    # print(bits_to_bytes(z))

# Example usage:
w = [787, 690, 216, 813, 845, 504, 941, 243, 880, 649, 979, 123, 320, 1018, 881, 167, 163, 919, 22, 97, 522, 457, 526, 144, 707, 941, 891, 679, 91, 682, 26, 266, 132, 534, 366, 353, 281, 655, 619, 898, 23, 628, 642, 309, 595, 997, 851, 932, 439, 308, 568, 428, 766, 684, 932, 720, 641, 853, 908, 514, 713, 322, 348, 808, 670, 350, 149, 529, 800, 319, 494, 665, 1012, 122, 647, 830, 373, 358, 697, 678, 565, 827, 985, 277, 332, 555, 446, 241, 361, 915, 456, 460, 919, 298, 867, 965, 829, 630, 523, 532, 700, 89, 639, 947, 645, 604, 575, 201, 173, 206, 418, 988, 105, 436, 510, 120, 443, 172, 1014, 37, 676, 829, 346, 237, 248, 99, 970, 587, 741, 295, 343, 854, 58, 834, 435, 324, 219, 617, 322, 57, 806, 936, 53, 448, 617, 463, 842, 203, 573, 363, 143, 990, 660, 846, 715, 209, 806, 898, 205, 301, 573, 846, 27, 285, 58, 213, 949, 349, 1011, 330, 407, 553, 596, 395, 1017, 787, 664, 406, 899, 272, 908, 721, 718, 637, 557, 767, 790, 357, 807, 702, 370, 990, 231, 188, 390, 588, 254, 928, 226, 470, 750, 445, 851, 404, 61, 874, 627, 206, 997, 302, 80, 964, 318, 116, 348, 838, 484, 144, 809, 140, 917, 298, 887, 645, 798, 611, 738, 844, 178, 757, 772, 572, 725, 565, 438, 325, 815, 224, 485, 75, 394, 446, 291, 258, 952, 237, 477, 138, 80, 410, 165, 884, 155, 645, 919, 83]
y = bitlen(q - 1)
b = (2 ** (y - d)) - 1
# print(b)
print()
# b = math.ceil(math.log2(q - 1)) - d
encoded_bytes = SimpleBitPack(w, b)
# print(encoded_bytes)

expected_length = 32 * bitlen(b)
# print("Expected length:", expected_length)
# print("Actual length:", len(encoded_bytes))




def power2round(a):
    t1 = (a + (1 << (d - 1)) - 1) >> d
    # Calculate a0 (returned along with a1)
    t0 = a - (t1 << d)

    return t1, t0


a = 7011276
result = power2round(a)
# print("Result:", result)




def BitPack(w, a, b):
    z = []

    for i in range(256):
        z += IntegerToBits(b - w[i], bitlen(a+b))   #subtracts each coefficient wi from b, converting it to a non-negative integer in the range [0,a+b]

    byte_output = bits_to_bytes(z)
    return byte_output

w = [1, 2, 2, -1, -2, 0, 2, 1, -2, -1, 2, 0, 0, -1, 1, 0, -2, 2, -1, -2, -1, 0, 2, 0, 2, 0, -2, -1, 2, -2, 2, 0, -1, -1, 1, -2, -2, 2, 0, -2, -2, 1, 1, 2, 1, 0, -1, -2, 0, 0, 1, 0, -1, -1, 1, -1, 0, 0, 0, 1, 1, 2, 0, 0, 0, 1, 2, 1, 1, -2, -2, -2, 0, 1, -2, 2, 0, 2, 1, -1, -2, 2, 1, -1, 0, 0, 1, -2, 0, 2, 1, 0, 2, 0, -2, 1, -1, 1, 2, -1, 1, 0, -2, 0, 1, 0, 1, 2, -2, -1, 2, -2, 0, 1, -2, 0, 0, 2, -2, -2, 2, 0, 1, 2, 1, 0, 1, 2, 2, -2, -1, -1, 2, -1, 2, -1, 1, -2, -2, 2, 1, -2, 2, -1, 1, -2, 1, 1, -1, -2, 1, 2, 1, 1, 1, 2, 0, 0, 2, -2, -2, 0, 2, 1, -1, 0, -2, 1, 0, 2, -2, -2, -1, -2, 1, -1, 1, 1, 2, 2, 0, 2, 2, -1, 1, 1, -1, 2, 2, 0, -2, 2, -1, 1, 1, -2, 2, 0, -2, 2, 1, 0, 2, 2, 0, 1, 0, -2, 1, 0, 0, 0, -1, 2, 2, 1, -2, -2, -1, -1, -2, 0, 1, -1, 2, 2, -1, -2, -2, -2, -1, 1, 1, 1, -1, -2, 2, -1, -2, 2, -1, 2, 0, 1, 2, -1, 2, 2, 0, -2, 1, 2, -1, 1, 1, 1]
a = 2
b = 2
encoded_bytes = BitPack(w, a, b)
# print(encoded_bytes)
expected_length = 32 * bitlen(a+b)
# print("Expected length:", expected_length)
# print("Actual length:", len(encoded_bytes))



#---------------------------------------------------- Nist testcases ----------------------------------------------------#
pk = "6924BB4257A7B9AFF095C30BB35C6AE4198263120F8039AA4E78E174A786CE008301E666F59D3EC5044DE456788FDE19EB39677B5F9FE14150DA463A706F3BAF715B95336B2D685A7CD7880713E4587BF7D857BF7E315696B8D0D9D49E142918BF0974E7F43237D4BE3AD394599E3D39BB7649932553447E5D5ACC3499930176ECD3A844A425F50D0511C9226C4B9A24F2A011CD88D32308E0312A0C87CC34A995823C65F4F0F98E50C37788CE38DC28FB8B9BFAAFA904B541EE712F6A041E0611374F6BF17EAC0BD56F3B6BF336DA9242070C2469A20C4D1616149A6159252011D299F93F986D875DD30B38A22549174570138C2BB3AA9CBEA91974F3D89BF5AE32BE9E58B854A2F8E86FF76780C03490F467DB0651C20B1DF60EB97A3C99D9BD664BE6A5E4C8A8AD4CC36390D7004E4BB421DAED654C357DA4D68498933EC71777AD64C2AE013C73EB457C68EF9A745ADEEB4FDFC879E774D03FAF6B14AAB10752E24B52D0F2D94D540A1EBE10F597E514442D6C13C2E2498E8AF3017C52DB233A90717DF25B4D072B7D88EE8731D16824C95D1FB983C449DEB466276060FEE4C7EE381451F232C29C7C3220850C61D1C3C00DB1CD9726A02A56609F3A65D3D164604588CD9B431412F1ADD914C5C2DABBC90467C0C4EA5F76E24AA618765F8B0636D7B065E1F4E6F622EAE17152458C766586772D363FA99214F472B0DB8A1E49D82D0278F2958B0AAA1586DB134BDFD2438742495007E2FE5B60E246399226947A12EA17631CAA534687CB75C060B4797EAB8277CC4F8A7A20387606EFE2DBD3E736249277D90FCAB992A8C99E85AB03EB4CAC5D88553958528AF92974718135F1D0C793EB000EA0AEC3EC1858FDD18688D1DA27278DEBF2CA8110BA4A204F7930E1C8CEECAFB73F75DDB34C5C55968A7933058426B55D039F7292AC43F64584F6DF187A1D6B003F514CC13B26C2F348195AA321DE6A27EC11348DE50D825A2964C631992E4B0B425B1BEB4F9600E3ADC4431CF2E88B4223D2DB663C3CE70EF85DDD56A9BAF138A9D7EDD894131C3A8F41A04EF9F86752B72181FABB37C86B877E61D60EED95EEFFABE6376E14ACA817C5F41961AF8A7849BAC094917B2D132276B6B3486AFF950D23D4AADC24CE98A5269E1C69917960A31EE09A527C358175CAA0CB1B018E9526D93534EADBACB52B273D735E22DD0D5C28FA3E47CFE90B5215AE24F146C3464BFEAF01D28DAA553C1E94428A104A9D78AEC762591E8879F76851CFB4648566721B0CAC1F14FE16149A9D8210CC8F2F50DEF7B46C843BE93BD8D55602493350AB560EA5BA17716423BE0EB8360AB109D8FB18BFEA040847B7335145D4F200D19CF6FE7BAC917F426C9B3D39A9CA4329818F240E7DA382761072F4A6505EA8E76C1E446FEB6625E38DDBCD3CDA81E83BF768F3E01D9D263B367303AE156C0B7183364A1E7941A09298A3ADF7BD231E6114B9DCE7952B113F78163138B9266F843F1ED97D9C2B163A6E8BD4C1AB4E179367C5AC96CECF5050FE821FDFA44E9E680B61C6018932DF717811459AF2542E2CDE77178C2E9880F011E405EAFA59C8CBBED76E5A1941104B1B9D3A60491C954755E02E894103F1F4977475E9EA36609FD67C9DE318EDA2370DCCDBB9CEF7AE6360905EC220838C9769823441CDD0DA8EF0ABE5F2D1D76E2FE08FEF53DE1D6166AB1A92B1AC093E5ABF7658C4B57287F2D1FD7B82DEDAF8D5A4FBAC4B35D58231694E162497578ABD7AA7C8FE7B3541A7F18E54E8B7F08764C5E68449DF655901549832D628FA63D2B2C5A150933994A9863317AD40D778D9D2C05C7898850B90173223C7A0AF890FD7E66221B6F06318B2ED5E199CB424885AB841E7A4726FABA2F9BB53BC3236434C35FBBE4B1A0F93F50C37896C29F8E302AD31ED3331D620E3B629455101A1F1CC7BA5E46E68ED4A8CCC87B4DC75BC0162B6330F833FBA2575DFAF5B5F28BC54FF2BA81E7A47313C15482B605E66BB38C6198F1392104080FBE78B86B1BC9A6FB881F5C7820147E6BA14B81ACCF20CAE96641094C216902EA5C125F6C935A150D7C9ACC5D9E2E5D90E38C0503AA9426017C76AAFCD5261B506274EC13A9679FB09796027A4BB759D928279B94D841A097393BF7E5BD69A496CC3DECD2B0F07F83392AADE33DC51B2A84F6A07635DC0EF57A9AD5959B6A50B7BA509AD5B11FAD26B419F9F1E3F9C7329B5A953D7CC87B2DE210611CF52A639EF2B3908012CB88E1D6F57625079CB103D6C98101A11BD2233B65602CA3049BD320520419F76B061E3598DE38152C88767D1A24FBD02BB10C38EACAE317DE6BB287B4D2CAE5DA0214965D8773778626E9B972859D8482B8D0547E4F56DFF87681D5BC5120F613FBBD91E1F14E6DEFE672E2A7EABCBBB9B11082C5E700AA0B1F7C1785FCED19A93AFE7C59FA2519BCDEB494C3D13B2125F385323B816C68F8F5628C7C2ABFD0278A337073DA74D16099698C4B114E8A8CE344E0A15D0FC7ED497B001D53D4C96DC3954D3B4B956CB9D2A272C51F1559B22904B40CC8531E40CC412C68CB6EEA4A4090B38E2797329985467E818A524D3228EACAE7825D3DAD2EAA422FDC77AED71A205DA7838D945E7FEC37E4DCA67E504CE35E5B045F56F1E8D7529EBD6F1AF7B6E939E2B7AB4027D37A5135D172DA1AF9CA2F728A6F37DE60DD23D97D11E75AB1FD51F8E9A1397E5822159DB583802B32EEBB4567ECE3746D1AE33314785643DD2A0741E7F1BF2D261F22124E8DDD08C640A48B54717517C21CD325328BC239CA028B2630D063C8CC20BE9BDB48502DADDE73FFED5963816533E020AED1208536255B1CCE985433127FF4F04D5B1E2F2108704B8B966588C0156AFC2AE192986FBEC443BAEF6CB85A6F29C7792405A24114710AE1C746444FDF5FB659E5E346826207B8C54463A0617CE17FF33E40F931FE576715C932EF29FD76B04A69B58E0303D8EF25678C8B70AF12E9045591C04E8B77106940415177E868593A09C7E14619A4B332F9ADC3A658B86017F32656C5429C115E110037A8CC7E544677D2DD239A59D54D0F3C7460EC15208346BA56DF5086C5DBCC41E0C95FCB6861C2C0C32AAF3454EFEE2FFBA214B430EF248A59B32444D8D0D3DB87C9D4B1536D157728EE7585EF532776A003A023C0AB0E9FF557108C390684D565A665063266AE6670ED53B0FAF8FF67829BB737825B153A9338CBE3DF1A462849B93A81F84ED07BE6D6240003274737F618DCB26E48252CE4204DD3139FF6876F43B305D835620FEDF79AA67433DC25287320E9917967B70B2D866D17B698BFFF2B3AB9514949E58B57C68A45412C1FC421C768BF5EE8A10C8AEF56926F51EC62C11569F31AA517868E5CAD89E958066EB9EDD7271B31CB4B1D6CE211225AEB5B57F749719DA07ECBEFE03881DDE3D81E4135F2DC81AF779776C1B8057162A6C982FBB4DA6A9AD284AB10C70022044F46D400BF6AD7182D197789983BE99227979A1334BA149D869BA1C4088123435BF978541356DAF171F33ADB1C97907A0FB5845074A85D26F546135AED0F91BE4539C12BF9411E4B556F687D069DB6B21FE2B7F321887448CEA55DB19FBB8B0482A55AEC16738D74CD265093836BE99D4FB53E9B014B037CDBFE9"
sk = "6924BB4257A7B9AFF095C30BB35C6AE4198263120F8039AA4E78E174A786CE003B9AC2C1422A1AE802DDD7464D3F32729A3C7DE894D506ACAD25CEB372EA3149C98780DCD1314BAA29B9B807754C47DE5DCA954064F28528B815FE27B79AC506B3AD7629D2C971AB8F282E0C6E7E5548EE0E113242B7A0E064A6DBCE30C5619B19800889A04404B50013C088C1302962124CD3B4910A352C43123119996522185202C38523440D90244A1A30224428618106291897680A200908326A44A44C4490218A16689AA8511AA52C62468D04C340D3862860A46013187084948C63C04404A92820082043162A23292D1AB12948B60921883100C53000C48CD98268E1304C6332450C328618083191980D10B8709B302264040893A48C21C9700C35715B000D143122CC98102104809B28641C308021307118335024254408178CC00848844490489830CA440009195119230C52200E4906321C154E194885132549A3000408156D20410CDA4252C1348C00316943822464946D1C81110196214B0200CA2884CC466451186A181000A4982160B06803946C94485180404692222C23446998264D1C01085202208AA6080A316193400E9CC81181322E21158484C24100227254226258069248484411270404C011928245A1C68CE33266C138725A86010CC99084340858A86080C070D026629B302A04296904108D0BB904504628504824D04805A24802C3208CA014004138214B240104B5494200000C2428124084A220449B069063C0888C14214912105416242087445010850CB564DB2441D042299A168A21B44C13B77010C085190269CC40611C4846980625601446E4226224272262242944C62D08318420322104B4610A3812D92844A40820CCA8290B21310A3429032140C1A26C8A161252A664A3B251042951C4049163B02D1444308C40660C400C01A52C09942D62C61103985019104D19A828D38640C0306554A671E0B4859B8610043669D0462918A371402249004385CB4028893666412269A42851D98029140721DA80911B26505BA0609942715088491023095A902122278E43B2700CC94CA402709240100A397002360E113041D8402D1B246DC392614C868D21B800D3242212C82112998509160C5AA22409344210A22403428CC0B28D12B66963340DCCB065A112114A3869CC148158440954A6800CA805C4388A8406019B322D831290090260A1288858104124400219344818A04D001062132250E338219A962153088051260199C4281BB97104978404052CA0C210D3428181424D61846C5A30491BC224C02028CA922D4A90100427864C962109194514822C11A69113B80403187001A2515214495A0230CB302C94102C00498609A025C2124C1B026940A444411662022528DCA22D0016425830665B8624D42448DB260C4C088501904921244154068402434A244205401448CA4484C0420C9826049CA205D1C2511301861CA150D902500C39868C0031220548D31081124805D1086962382C0A23709B4472E3486E22967014336CD8902903004963208A039125088921C0820C994032C2344E4B9869098044E4046994200999246D09A96001292DC842288A3402E408700C236E0A054964442A82C800024831CB90501C056812122CD0800C594861CBA6099CC08142B80024418A94204042144D19466218050924336AD400611248328A047293B46962C27141A68944963162304683426C00192209464D8B0649E1B070424431C180659C002411A83113212C4B46281B180D884270D1B00D90C845DAC248591426224400C2944150C804180000CBA62419021010890C18222162A881C89248D3942082067209A8900C498A41862819C5809A184D14102E2212520008120C334563C63010934C60C631DC400E98825060022AD22240E4062DDB320ECA324ED4182408C3284AC268E28040A1C86451C265CB166023094C820468D9222E1C499242242100370EC812726408250A202A58240459164C08173000460512904003072152C0641C836D9C322E11158A1035885AA08DD9804803B64C0110651086401101420AC164DB224D64B25102360D93463114B668638429C8102494300819370214824588284054A8299014126136120B098CA49828C292454C006063C481C03625CA882D244030D3A82DC9C825D2844800329250A271D3440D223460121312868C5F8620794A050E20D0E1011786240EA664F2F69BB1B7E30EC66B1A4A0BE59B79F2198AD9804483E475E53B3C49CB0CE5EF92912AF440F23B995813D11B59F798E93C9D13539817C7AC68CAD1AA1AC27656BD0C4797E9C8EC17784C1A327A9DFEAF4D6191EECDAFE049B733FE39D5EB4000936FEEFCF82928E9F94CFD5CF4C1E3DEB1433A47F6D328B5E83DD156D0182DC692347591AA6F732CFBE982935FD1846CACF4CB8515C55AB85EE5AD44CB09D3269E2E6D11780961FD131D5E6FBF89849F47F2B71D8283FF25385E52B07DBB266C674CEE3D0B5DF5A56D8BDCDCFAAEE6A248E71DB1345AFC597CA830A1A35B4396EF4C1ADF9ED01BCE9B6EB637FA24AA160B9076BAE30559F8B29DEDB3D25B79064AB0CF8B8D70ADDDEB8B174248D5AEA4D18DE43B8938CDD2ACBA5477BD4AACC3CE595E5D269FE675210D23152B04710F368428794A75F49B683ED20DD647515777955A8CB38A36AFCD2CE0ACEC4F0DFE807702D1EB3BDE72E9E085AA4E09EB1B0947413852EC3C0AC52F06CB959C85394EB3748119EDBE6C80D2D8F792CE0D915E4F4B151EFB135E7F4DC97D858141C57F70417B43A6A126956978D78EFB9F037243B4CB41DF968B7EE5B52087F05AA9FE487BD16C0347CF1335760BD2398AD54DDA00A5AAC446D80B1C7998C602192ADAFCB809D14EE328641BA3AA00F8D29C3A848ACBDC1946BC0D35E0BE0F8F7E3DA3F68D9FA9768F5CF275534A0ECA9E60FCEA38F1E042C316143A767B33ACCAD8C8D66C70C75FD1F0B2586B653AD4AF54E56EF06933EAD31DE365D110B9C4A2A98BCBA165CAFE386F887C72156EB14FF0DAD665616CE3CE65C1904F2C1747B2EC2B5C9D6776BCD79E5AC64B7933BDDEDEDDBBC725BFDBCCDE2FB375AE2BE3537BDF89BF4C25F83A49D6A6A8D0761CF39D620C53ED837D198255CF5B910A6DB57877DF92D8BB6E9C526B8C4EC93100DEE0500A210C984583E1538160EDAC2C6F866E7F5D99D7B1B81582F5D0EBBF2786E3F556013BA9B6F656EB798838EA0579201A95D56BBC3BCDB9511AFBD4D81288896F87108C077F1A81A3BD297BB124A80086890242995E03CF42A0C21E272A9AFA1DC103463D2AB494F7D017686D31894DD2F6EBB0C3CB6223EC79C65D45C1B0D4EF1961F16D653FCF25977B651EC51A13AE8D4A3472EE71969A7A936F5DBBB9396A46D97642358CAF4894C9A6DF84A59C5962A6990A76F0614890169F001870D49CF2E75008CC4A5D85E72DE2D6CF3FA71852253522FE8B0E423CB417A38EB78C8763C3720C04E67FF88979EBA09E34538BB523B99B8E34167412F77AEA894D83ACF946FC054D0AF47295E51ED83F7486940A4D41C04AD7EBEE610BF1D03FA54071D51A1509E4F49163A25081BE8790D087F5F4F05C88550FCA9BF99C9BE5953D51DD0845C93E41EEEF62E0794B2927C4F5ED9BD3E34EA9200A79DDEB4B2D8F305FE05F827C7E2ED186341CB5D1152FC80104E0E13683D941294C778417164B684A976E56E78DA4D17C3C73229314870B85C455C23B830B9A28A3D8C0B566426DC169F326ABCE2EFFF39E9B199AE5C1292B6F2EF37AF1DEA9272C8D5423DF8A5632F991E14DCA2514788B62BE164828E9ACB893DDA602A5E2FB9EFCBEFD95ABFB82D2B02D49CC53084A49AB1BEC23E5B4C8E714CB03405F1BCF7E11BB59729DDC0B7BEFB291276DCEDACAAD39A2F01C7DC98B9E065EAFED1CC8CE3E848080A2FC5B98C9F6BF5040273342F0312F8B9844594A503DD3E6AF1C9E35C1032A4A8A5E7BF33A82F35E16EDF8C60C90021D8C0BA4C386245DFEF09448431D8C00D1E26EE4D8C77DAA1A705ED4792ACB4EA27C1566FB56683C43BF67842E67534CB3F9677C8AB9D0EEE7827CDEFC223AC948B880B5F1CE9537272932002C1A4DD218F527166EBFB2B2FA2BF37246ECDFDFA72B6DA11C30D1C7D248AD64818F691D59B755DAF71BED9AB5FB52E03622A900D66B4C6384169BDF9EB61C02DF45FB76B1A26F34E938B190861745C021FA876200C7FC8E222DDBFAD8BE781B185424AAAFC65862DB132BEC6D18837A1F58A876C99E63F51420B83F459675612F7ACF80B4EB1DD0721CAA1B4970DA608679C6383E817FE16B66B19181EDFC39270C7E917B1F10EB7A011997E967853B78E00CFD58D224D933CC5A995532DCD4E532E4030515F4A05B331D575DDAC29BAB069F09AF0D173373DB1EC2B6366BB371008A2386FD88BE77F5ED5E198CBE88DF24BC6E393FEBC10C470A72D47C0F834653C9AE800E893C6BA68EA28A838FCBB69C3E964A5FAFC2067DD406B257C98DD3979EC7C7ECBE96A33D85515DA2CB6AA5E1FFF204AF62DD4119A0E48C04A3F2B38660F52964D8D4AEE146A9C53C31906DAD0FD90B5D83B3E31B690A4C4935249981BE1F1A85EC6E0FEE4C88F2D89E2969AB8CBBEB501916558D29EA7C3ECF1C9EF1A04350633B4CDA737DFB151CB5E7361173F3AEDDDF527D73F2F9D5B6213AA68F883E9A2633785EC6BE642A9FD0F21A42F6B9DAABDCD1E6ADBEF64841B59686EAE3EC88EEF0A9CBC12BC012622DF2DD93A86229044AF2F260D2183F51E833EE92D98F0251E3F85FAB74CE367B8B7AA63D3CF8C8BF4D78358BAE0A0241E210AC69353087CC7331357EB4450F9509CFE595F54032EE057754A8EDD746CB9282E768DC6B830C5B4A219343AD124EDB3BBC42505566A7038C959BC35585B6055F1968DA243F778F4E46DB462ABEB93B81243C31EB59622EDF81F06CCC61D2A6EA73E109C387915F277BCF1FC11105BBA70293C0FAB5C065F23BAA19290A302F08091107A4B1D568852622098383427760EF8F2928625BDDA5F514C5ADE959891EF2959F248A3532BF9D30E714059EBDEC958708F8A83C268BEF2682D603CA886347E198FD68233999C77D30D7455DE6BCFD0144277062B304BEF0E34C5A9D8D780D29EC2321E07340771C46360483ADCAF12D5B79FDBFE2856ACE8859F6B12414B3F7E8BB5813498960F34FDC64FC848579CAF9DCCF19B4FB825ED5716DCCCD6872CBDE3831D67384942CD8A9EC4BBFEF5706B8F9F05FE1E8FE69D3EA6A8621C22144177B1C1259E1A79DFDF89728887BEF1A70482556831B672440E13FE3E3FC8204A02EA1EFF19D95253887285BFBEA16A0F219EFBCEC30A8AE86589A5703103A8A393FA6F6B657704AC677C14CD10D3D62D13FBD378C2DDA325B61B85952D51293871E1FCDC948C77BEAE9A6F0E87CE1A8051C8F8087685C12624BDF58380ED66F55B43DDD6D362173A5BD389859C17D95ECE3AB732639FFE451CD103EE4854DB2F39614F658BAA384BC9948D0714EB48A887143E7A1FA4B690C22B492A70C612B59FFD2D6B3B5E99C2003E2C359B1E62DCB620C7A246A7B9B3246131556F2F3D513A23C6A9FD2280ED686D767CCD01754EB4C99692F2B380C36081344C1D35EE1949736B6976F4852CFBE64FABCF11B9AFB828576B4F9787AA7D03E84598A7143EF7311FAF2970E23ED4C173F985D6450165AE3E241A18234E74FF3DDB921A5300B1C4FB6E432E698F53F66E38C07BCD6E77605DF4624D579076292DE1CE6FC6F0081A38BD92D39B24B73BAC1C52BD68E9181D3DCD0AC7534DB48901E5984F9902557BFA231B2EA28C3183262A1B2221F7426EA88A5816093A5CAE2CD5D59A9390FC93A2956944B064CF013BCDB67FB423D1328D2C6D7BA329013FA2D30EFD69FDCA1A95EA6D06C7363534B2F3F7DAAFA296EAA09B3668E9CF82D9BA959B32F3CAD3C10C6EA48611554539C37DF6BCA3385EAD3FCFF96D372B42393B73C8DAAAA31506EE0527B7FB3E593DCCCA57C8FBBD4A3C7F8A53899869132FBC3E4050607BBFE29C675E3945E74A31CD531BA7AEB2E2F0CD990B8F983A90DFEA0568F0677EA9563F7C479DE968940CF242992692865CFDA89FA078BBEF49CE4575BDFB380366011C8435F12B42D9AB99AB6A31912C4354149D723101D1365A65E7CC68D82E30517773902FB38DDA2B324E7208E987ED287D092E7662A430241BFCA552D314127E38C8597A89519D4F1E62A79465AD5F4EAA3FA77CD98326D2F92CE9852055CECCF62D63CB9D7F198AE085E4D45C8E48FCFFE593AD652D9154167BF3E6195810A445AE158F1F9A6793363AFC1F22CA882FEED3A5F5727CA76477C5F23F0FC8700CDC6A5BCB2B20B4F9266351D304A96A82BF5F314AF685C1C707C92E3E847B7047D689C70B25E5501CAEC9919626F4A0FC81586AF1EC88889B423387D5D95482618A650E80B53B07CACE3228940602E3DB47466CE9BCCB6E4D8AA61C8912583E810B3B2E7E9CB48BD403ECF08D28C70AE0B620859C1F09B61131404C3D5BFFCD860E0F42AB299006230B2876D77DDA91C8C62BD93A844E4B344E3255EEA531C6C458D04ABDB0FAEF2D1C0B4C55F570A5A51023F4D4EFFF59F9ABE17922FE732CA71BCD434AD7710B84CD4AC9F2507A06826562AD7F647826F9DBBE4EDD23F124369DB8526FC2B4D52F0741415F972BEF6A935BD812A56C8221B7DEF0F5106BC01E913E3D43DB86C2BB4C7E0762663C6DE788721C2AA07F8954887E2142F2E914A099EFC0AEE1339210D3E53DA3ECF88624B1119BE34010B886C80F51D1850838F2150E72B042AF32899C0D3D7B02A57F8CF263A369562E4E945A31282A502A95EE9BB0316C6861006DAC17F936F54C4C7"
# print(len(pk))
# print(len(sk))


#---------------------------------------------------- kat testcases ----------------------------------------------------#
pk = "770e3dce04c9ff59cf5a05a04b527e9ec4cb615ffcc930a261677fc9fa4fde7f80b82f873615f3d08e4f86e80c1cbf895e85b7cd8f61590c5960e364e8bb850d02cec029ee2dc071c7d328cd7bac91cc76780cf810266778dca047f309ddc40c01a9cc3248ed4cded489c743aa58fb16d7b37212f9d5ec60bd76592ef7ea0acb5e22cd48156b72430e9665a50f072cc24f34a7c834ff52437ac472db327bd56ef0e1836ed588332dc0562717283c5cc6f0dd170f2c4e440f53a479b19445a9d6e7c174d85b92a120cf5476d887da5caecd93d61cbbc8fe8a4f2eff097852dfec2cfbcbaefe4d96c6a5ea7f83c6a8919e999052539a230b7ca8b632be22fe31c278305d8242176605b723f41fd85b7ad66a4d5a882d2ebb0052dc7c576cca9098927b682c11070bd447712f83f19173d3bcc4b2edb4916ae13bd7ca37d16f6db23c03835517383bf603816df64a48cc6c025fedc4a4f2fc87b5a8058fdd7c619c4cc2c1280161cb895b16f8c27eb7b4e62f74c6a8db61d238d67c9c374623232c6d4194fb207aff07d4c839f1809b89940bbe79fa707dd30c3a004a66d561621ab12479d40d8aec32c17eaba8b49ae40ddd817a26a398de85ab3c52806d49202ac8539447377919a73d60b9d08b18f450796bc4346e3daf0ffb1b432e8fa9da57fee603344928949de37fdabeff64dad7b1b10c8291e9ea4e149073d7c22c3813156b9150d5431e74747a5cb00b108e90d59ffb5b7b72710955c78a3b8c28afb46c722927a09de612fb1c7b63f2892774b7f31ac60574fda9b01f0a393ef01c5f2d398c8f0706e51c3ae9ee8f295eb2059321513b7f617df3968289106d72f8e696819dcf9fee363721e31f6cbe4040e6d698d1f554e7a4ef2866c218b352fb4d15b14be0b93eaa56ff598a6e5d0a4cbf9474b5b11b354dafd755ff124f436e7a1d8b4a995849a2ecfc36803a3e0666fd3e163f07aeff24659f05a707306da56472005f9a22b0c74b5607102a5e5a0e4cac36cb110ec447414873df4cb15c4b3fdfeb57df0b79e184101fd82da1a07b6b4b9537ee2c1f125a5082322759a9211eda06060a2eaf9172658351e1e34f6f52440de5fd36daaf253e80ef575c122e7975e29e508c86f1cd989be013295df90a1e8d9230617c378c417a95a00140329b2cb4e704ef2862cc2dbc14296e1e754312e703470ce330d53966a9814444324404f4d2a23553a55189d0d4759004bcfed14139a3c3534ff586ee522b8b64a4f6e6c4521ea05362fce9bac2d3d8336250e619fec5c742a32a5c3d143d6f2cb50e0ff9c9cf5510bc0dcab2c2386698c7c2230c30cea8b4420ad26f7ed7b26e163c64718a391f41a849f089da698aabf7e102d4433f477b32ea0bb5a9c33b6933a0e4e9e0fbb02460984965c2dfbe52ca0b20b55a7ed2972180103abcea7acad3a3e92d7dcdd7a1e0726a0394417f8362b9193cacdf37c5dc51868ec19ed5dfa378d3efbb663d8272495525c6cb4cb53331e72f96e9f6e0eafdbb63dd6fbcd36bd0667e86dac23a961b09471d6f14def97f40edf82d4c26e6d2c74baac76a39384ef5af7d0126299415d74d3b27745342641ca8b9aacf84d3d0c6c2997de528c6130e125eb81030892eae52980c08052852d6fdf4ecd06c4c3d80f71fdca5f78257f32f374b7fb6137a9ab4ad16a2a1484c253d4a0bf77248cec323e91754cecc3cfea6d4f5ab5632cd70f0fe04f13c1c420a98257256ab049b522cd0daca8b797b18ee88fc28423af4b3a4aa9fe2ec1750ec148319c5f0efaae8105d081437b65ecfa7543a03674f3c40c782bed5e128fe563e857310c5ce4bac01f3d6acf0872ebff86de580fe67bb2a80b92875d0e42d79a4be69186b17596e1cf772ff6737b08c9d56fddc22f67c3d7f05bb5182c3d76a82017a58d3a06016fbbfbbddecb20a0ae439c11752c5d33c3518cada1980c8a982bd194838e00bee9953853281f1cd9f7e9289004c10e6bd8e30f813f624c019f5268cc1fdc149b413a85ac6bcb2c0d37b317406fa56fde397d4d4857f814dd9778e8193491e35333aac8b8a7f92420578149cb0863a94b91fc63120fc95feb5c6d85f772884ae2c63042fd9384849489b58940619d3722f50b557ac1434c6906852df0c7d19b1bf87996e9f53de79357ba51063d8b7f12edcad300f03eada00feca1e3bb1defd5e0b3503eebb390061c02296c58708aab61b0f4e43113571521a962b2f4114cc032bbbbec84e4bd45059caad42fe1e1e0032dc1a92fb0114d1d7f626f0a72707d876f6bd62c23b95652f6214de2217bceed621821d64613b090f938f4b2c1683b01671a87c228bb4d76344b747c8ddf722204aad3ba88c8e41f5b679e84c919f6917f5322fe723392537bc0bbd27999e4bcc83ab10762388acc9e9564e055b4a41d9f3673dfc2934417e60ece2a50d1c35097ddbec2eeb88c727accbe527e5bddad6343fb42714806fadcc13e5dfc86f5e13f1755a208bdc91943f6308539152d7d4d1f74a93b2010dcbe7b948c1b6a9d2e8c8c07f219170bd270922ac8f4a56d0d325c20c994b6f9267a2ff2b4805006e4d6c821900fe569e3c7ce6430ba2091aef7262dbbf46aef2570e0897db3d0fdfb94a7c5163bb2127ef527b44d7b6144bdb561e5ae00f7528f4e0f67a28196978ab0cbce640e6ec18584a625dd390f2fb01d6fdd1b2a82ce179375c25189a613b7ff73fd73a4bf4adda318ccd58a1e1c7363b8ae90fd9b0c64c2e469132da703ba0121b6642ebd7087bf0b4e932f8b8a9fb36ff4a8b5025d8c08b18b17b92469806f0ca5e3205d4a36e87dff959943539e7472621e0522c4be5862e5533b51f48c799deea7d9adca27c6bcbbcc206bc8b66b5a2cb4093722450630ad5f923c9560c1470fcd6358f72d420cf8f0421843c1031746f371b59e7d65df66463bfade99f133b90a9507ee97ea3b921d1b2418b95fdc5ddec77043782555d365ec8be6421c192185705eb75d0e7dc5d09eba26aeef2d1b031d3bfa581852507f4d132b1261d9e256e1ca3d64912ad85ad96e472aad2b1747cf9774ff2367b85aeb0e44f73c91edfffed98b79a1f3cb72b194e0f3fd43aba4583252564e9ea391f8a93628db98357086228447cb6b195137c6756d5440b86cc630e00368a475ddfe60bc471ad55cf12ebfb18fc1b3237968fba13d2648f155ff41dab5fff93779b698996429a8a0310171c0b7035bab2622b407b6932dc186b3fe5cad728e702d894ae05cb38aacbbeb76567fd31176b819fb101fbdb4b1f97e6dcb767c67b3c73e5d5127c9643b3d71ae25d6543a1444ac95b36f61cfb4ca3fc50b49ecb4736e204a6d49dbd9299d479f6c42f3cbf195b38a2328e608d246a0f0b73b48d9c417f04dbea3542fb256760d230c8f453e762e8f10ece841a3fa12cc72222f98ce1e8a509a63dad6e4dbee801a2af39160e00b1ac1c1dd6c4242799aaefd174590087101a6fa2e400b4f31ddf7a101f3a99e4b2b2aa09a22dacd7fd15286b97c0b9eac1ffa945ae5fdeffdf9de7e80dfbd739f4b1bedda697945fc90f77057c66fa003ba527be8c1424b049c5a257259ba65601ccb79a8c2761a61d63670a66d4ed9b0937cc7db24d922e2b1861858a004eec180555dd41e4c734d918"
sk = "770e3dce04c9ff59cf5a05a04b527e9ec4cb615ffcc930a261677fc9fa4fde7f80d7679d91f8dea8185d8bae5dfaa501440babe547c0dd6fd1e9e4c6f8cb6695b6c1c2736dbb308050a5767c2472127e2ba421364a4d0bb1ca5e432bfdba7ab5bafc3b51ba17155aed173088a88e1a41cbe822545493ec17ad43ff670a2996308c3611e4b890244411a1c4508aa09110025293a6604b9264d3824d0c392c88382094c80509150a8c183161420583489164342d033900cc022c92420604c384c8088604b32498b40413a141144290644890d4327102175189a62890a41012a20cd48889da144c0a268413054a14b9296124209b3628c3340e62b670dc143118416e2489802214314210010ca90c21334624920803056d84164ac91401924429a0388d02a15004848cca984994984514b11192088ecbb86520b780c2308050144462304593822908066612010898925183a065d2a088c23488102580d0a028520469c932869b949024a510dc9429220029011286242848c81409a240121c278d490891c4b02804246dc0382a812266a1204514a15064b449ca385291382d580489cb4670a382914a204622a0699c866d4130692142504bb890db148d5a18692283119b26309c9645c234020c92251c096464188d8b408e0cb32118b66c02c7290a46455808501a980001034121068e13134482924908410d004292d02011a3168a00250dc4001224938c841630492202c8c269e4420d141972e13089d890650931298c444cd3860c110001043211039311dca2111c2765a10230a102041a866099a691e11485c8044edc261152a208dc28861906848902811305291a970d92164e19a96409480dd4382e940885e23271a3266900328ed93431a2082512a5701a326098a24d242601d9848c24b62d11360a21018421a24d48a84511344e90464440a80c5b0020a32072a3066c894892d3a68504250e60286609020d139760e29605e104111c295214b3650b069048088d13c48da41886944485081331d0060a62448953b08d248761c9a60052084d1321699b488a24342c88960809c709a0001222084a444452da122521a9881018280b814ca13090e4c68c52b250a3b010639011dab0094898899934455222708c488594448e213901d48608c1a864c39029c8102a42246d40264403196ad00688099784c4101243c07062222250184dd8104d91046e52220e0c2286111182a0b845d0064600386294a08010426d50226ec102890a24666196316100529b240950142dca380223152d1342055a468c1b015009b06013c201c8b489c4148d53c2441384900c1090d2a82ccb328e24a66888224014208d0c4985c18480223670424642c0200a9c8488112991919668e4222c0313855b42889c144014b468ca384c013746d4a06563187202c88d8a442e50100cd8c0215016918ca0511bb025dcc240c402426240212190495ac68411130e223466d2a68da2886963140ad9a48952124a11b591e30002981021044440540400dac465e4808593a880410471db84915b04495b2048248970cc4251d2a400c9a224249860241362424071d3888400034c19974089324c5a4210e4486a51126594088e82b64d80124813884193224854348c9198291090281a958d8c360d8206299410860916320c472988c62da0c84d5bb48118185211220c0096818ac88c1c2882a2b088c334064410821b8109ccc89123a40500a06808194a88204224b069c9b66d01454c94184ae008440b010a2445608c3242dc066d938864da3060a4267260126ac124291ac3848a16710ba16598c40cdb462c13121160b6045c166143c825223509d9486d4c288888402dcc186c034091592649dba04009c250d80045094532c2300e04069018182102c70908340658a0611b31710a422edb0009c4284259480a2481699a9820e1160a41026400122952925110126a9024621932061b4480d0128851420c64368062204620c380911069daa40dd3b02d44a48413246e993608c3823190a48d4bc485a28244ca34461a120d94a868ca2052010545d3c04510890d92c241d3402504088e4c1266cc160cc012711a055201946540008a9c100190286c0125521836100822081b1521241540421848c4a8681c4470e19445d2440949442c80407081908c04388a04b91019b5881096119cc68cd230300a8990c300521fe3219f48bc2b4cebbdb1b1ba5e260d1d13f3990a07d34a889c550eb6b65e3e04e9d3ec8cea604c735b4ee95bfd5b66d451cefac1da3f45aa1464307b02fb53169879d4a93ead8b3215f6c83c076f01cf2acc934ee3841a2facae5473643571206b2f5738e2030c698bd6f9dd5af187670b204f306b0cc02f34a3dabcfd188bf991c9fceebbd8f0fe0d68f080ccd11bbd7b15ce81c2bd07adb0dc0655c212da78f601b97c56824502710bda0dded6699a7784752ff1257c63672b075103bbbd3e35189af07228b224bc605cde4ff3c15a1e7bbcd9af02fe1c7096d81d682d76b23a23ef80bfad5fb4287e342c8daaa1b0c4324d1456a3f90e45a575842e93881d62a98be37a06d666d0d4cd79e9665612bfc4a0b35de6679d12501c4975afb1e88949927b030d9104e7db91a4126b6a93586324220a3c2d6603759a8146d7f6ac637c1b3761fcbb041da54518fe17deb9960945d9709a34d8fdc4abf35572d4cc055c77973f453a485a30fff3a7dcc89279e6be0a15552ece0898005eb87b85b6be031d0e24824601882475560746b4716eb7d826ef65b696dff0851459b59b5764e9ce80bc7fac6e149d795011538738c0330ae0d1a4e3b32b4221effc062a03e338264526ab3a2a2c54c525f666560f99677bb198fb0b5362d309479f18fa8904d3eaec879229343935812f2b30245e0043743a6565cc89cd2b08426d5087d673469be2ad2fe2b133a69cc5c18dc08d193fbaf185df24a283ef6010ad4c8625d98d51e440760d948a7beb2b535cb68e4ec2ffd277566410d3fd9e339eea1795878e0c2d55c03a739135deb1399b1ee97cd4e60e45b67717325a7d26ec00694bc8043b4b9371d7ca310bf0a86035a4c7aa8129206c005538d0c8ccfd62a30eb210fcb86fab7cc2739d544f7bc4e9c05dadae9f8fbef0cb872fbac61c3016b21606d3d3d633bb51cf5a8f6a3b1830d66ed14f3b05a2cb2f521ef052b07c22663cde97baaaefbaf859347235308fb0423825ea2136510fd226d540cdaa9ca350132b6696aed0b0449b25392839fada7950ac3e37393b937af19ca5360692f24f0f16e0f33af1fb0294382874d27f8de01b6915b12bfdf36c6aa52cad659496a7a53060c838a0b5e3d34bbbd78964f93638e0bf5b54fd61dfba06bc2a587f0b821eead190f476fb378c349f31283afe86b8556a1b60bd332f30df399502ce9875617bf7716301c6224d3acad9fc9bdc531ad6267bd8fe626d4c8561004b12f50d52cbdda6aae735b44b6abba37de33598c6710fc310563251076d2c315b123c9d9dc9d526145db2f343315252e656aadf3ffc84381c20bd71d7fc0ceacf54a8a213baca116c408a3d08eb0dd582e03b0a280181354e62180a5a11a02397b8990d4b019d05a1c99e91683498336b1a34a3d25d6982d332b0bb92bf7f7a5ea4cf6ca352cf285400c6ddb51899305cae4d3ac79e9b1ae9f0f988da6354542ac1605fe95d19346394e8540cc1393907439a8ef78d028146eaaf770eb9289c64d11a3758bac049116a76e05cf7cd9455ad3c8f49f70c80791046f533b3f839a341e0ed681941235f97a056ae0fa542a40ed04cf352be4db444334602eae32efd589999a875fb6dba6da607c5bc07da3f05a0278f9c199c8c7c93fade5e708e5578323cb77a3ee5a5923c66c08332e8359c9de047b79502d26af4f3ca6485914f11b9bfc8b003a876661edfaa5f944701c85eee7d2e5ce38b0d48a307e84108735de68fb274014b443505b7e65365fa9e8e63c40be690926720e9111e5c2dda6eba897a74e3afc67dafe61bc224d9c5c8583ed8168688d9dd223b5bc0d83de1848a7c1347d8fc92f493b2092d225d6273e221c85b816de52e684a25bf00571573b1c30d9f99d429494a11948175adc4ebe8336e9a5c2ba2f283930e127eb347a4c55a8862e1535a35d716a8d3386611ed500046bbc81e0b204c5f4cc115c8db9c6d5e2fc83a0664dfde67e050b6db60934b5742ebe42f2c8acb92f9b599be8a7ac60c269b33a998c9d5f953b592cee9e941ddc566dcd74b0d511768a86a861b3c6bd5de35f8d68bedfca1ba834f628885062c222dde615ec5ad553817ac9e759b3522ae15d1a717eb47e9a357a48f037007a52b0eae1733789050bccf787dd302ccc47c990034bcfff2df97891092018dcd9211354b8e4eb06f7c46ba8144384b27ca39114bcc52f00a90f92e670133b4c0bd4bae5c15ff3a16e69863ec1771a2ccfa4217c4e1209c1585fadb43495c070ebf34cd5377c76b0e7cb7fef1c57f82ff0d53f77a7014287105ff8cd76baf0c4412ac1e9fcd083c3ea483982379ea3207d66aa53e1df6580fcb6f93c7949ffcd0fe12e9e091b3933ce87111242546704552fb8d21606175aa9e2c8c41f3325aae6b33d8b96f657660023861466347aeae881e2f07fceaf2f59f2552109cbfa7fab9d1716ef28606a9491b7ea5a591a11b580a74f0b5fe29b53aa1ee371b64f01a5d6081f063156d83ea8b656cd69e53486b57567a08824be9c2e137aff32906e738dd595a1bff2ac17f1af98fee9fbd408b38b3aee0b3c352e4baeba9a9c5215ec74b2a6ed3dd1c9639640a10d2da262ea0416a49d4ac0d71c35d4c2b6f20ff2870725987e05ca04038aa6b1bbeaf4966c6459bc63ff2f6e4bc4feed9165141e087e16fb488ff7381a9693833b4c5c360c219aab9aaf913c169b0857c9f7fc06ced11653cbd17a7b9dd635a650dceb6097a955b1508b426428af3d3d12dfeb5032b84fc05ddbfd4ffbd3aadddbd2fcbb283ca3165e08cd4db867e4188e1ee7b80f5f14842fa225de735e5956e674a1c6467fdb97961252b0bf0ed5c8da7152fb533923a0c874a4355632dcf7724a582582bb1d2a0d2b71c7290f25f78482671ff8601d069a9529bc45e4ade6f677fbebda27295ecf7926948b7e5e250913621e240545f7070c760e188fcdba02ceaa5e4e33c4945ad029d2d08627f9563f36109dd7f7a6ab88c4faabb770034e3da1f9c75a4b706f4e4505e88ca617247c392cbba017c26852dd241b3ed92dd1b42078d65df901a086591112f244c882c08f14a10e72738fbe06af8b7d9b6cf5877a7c197cc09a4937ba53a3c69e8942aab55bd9f8d8baf9336b9182421d3d440e4f5ec8b66a3c739516489c8ea20c450b98ddf13cd9eca5a05e1d5960a2e2189b32242105fb90e66863ffd91f4f6565cb1ea368d0f7cc91984b76a8222f5016fd55fb2b15cc63cf91483164d54bfe92b3414a5078e44e1533ea31abce63df08ba299847495891de2435c198df2729886e19e1c97f8a916a8ee876ca75aaeddb015eacbc116b2be7ce119c1612f1c695b7c0dfbec46cb6c2a5662b7da4bd995b87267f021b88a6f1f8b0b8c33c0b8252af14a38a4a026daa579ca00496062cb50acbf9ad11d439e876038068f0f3537b7f634c30dc8325c23003c142de3642459dc35facc88875323c816081a9aa3e7f1efd68d02b060132397bc1ef2112b3ded6a7202ea65ebee73df7f1cdc6b9cae85850b13be41fdf176f5c9a119f513cd9418c5078283e0d155e6769511d8bbf4e74d6c5ad03118935afc71981b6ae6ca490da0b9efdac5dba3fa2da3bea4678070ed31c66c8c5e93c72e9d5359162f19ae5ffc3d1eec453c5e79d287d7997eab64531cc5b3b0000298893eaf94ba805c71a3a07d3579068aa5cdf5b95acdd879cc5b23950184993e62be1386c9a924dd9dd9e232d38b1d52cbd73f023476e3f6e8f4bc1b8383eaae0a73af763d40ee5944ee6e7a53b37589b7ee893b6beadada7c824d283f7e2f40094404ebe9a17a3ed787f293ea526dc141be8a8738d266f8be398a3577c0664af861097b2ee826a411c43b364bf52ac5fda33d78f8f0a94808dfe17a0b0ccaaefe741a0f94734fa332798e4009d3575c7ee1d9e8a8c32f8c982ffbd1f316cf39e835b04eb5eb4ccf4bfbc1ef6bcfeef8c5fc2ac2623a16f50e596615a456aad41030654c3589abfbd680966673aa93129b4d48d60c8a11ed6c3af832cefff09f8cd9c188d3e9bde3e2911fc7139072c86ce9355e84c83b82881b384e6ffba16d9c64a32af8073e4c3e1089f6e54d0e2c89f81b7f04c2ebc9b7237c0e741d98eaae1980296263a967a917ad9cdcde78e20acf1e6214f84d77bebe46cffd4b515ec3b0df7a123170836397cf240897b1a5edc64743634fea9b878cc45624fe1eb5ef990fbc70932ab7b8af8b3b3526ace870da483b0003cd11f43c3c12c059d9d591dc4d74b3b25a0553bf51b8cee04e63f6ac17c892aa496f6f1a94148d97455d0bcd7ddb30ed0f1271347e48f95293577be0a187f0906dcd03c350972d7508166026ccc249cdfe7e63faa5298044202ee6acbeca822908d703b5b5815d67141329a09bda2cf35607e7ba15e4fe062b3d014080a06ea44adb38ffaa17ea05a3aa32acc589ba8bf8618f2aa2e9badc3bb2d27bce035cfcbf038e585c836823b2ead697eb0bafbdd929be27cf509284ae1289cf624661e635797f53f386a7c55287294faf1a5e46245ad58304149ec6cd78a862b1ce8beedf23481a01706ceb12c35e3eb7b81beea1f763025a961b458208ff0259b6bc4d681d2cbab72cceeec8984142dace0db56f0ed39a4b7f4a79543198a6f19a89b3cb4e8344f4ced7cd2c14007ea029e31e3d9affaf0d04b178"
# print(len(pk))
# print(len(sk))



#---------------------------------------------------- SIGNATURE ----------------------------------------------------#
def BytesToBits(z):
    alpha = len(z) 
    y = [0] * (8 * alpha) 
    
    z_prime = list(z)
    
    for i in range(alpha):
        for j in range(8):
            y[8 * i + j] = z_prime[i] % 2
            z_prime[i] = z_prime[i] // 2
    return y

z = b'\x0A\x01'  # Example byte string (10 and 1 in decimal)
bit_string = BytesToBits(z)
# print("Bit string:", bit_string)


def BitUnpack(v, a, b):
    c = bitlen(a + b)
    z = BytesToBits(v)
    w = [] 
    for i in range(256):
        bits = z[i*c : (i+1)*c]
        w_i = b - BitsToInteger(bits, c) 
        w.append(w_i)
    return w

v = b'\x01F!\x1c\xa4E\xc48A\x10\x07B[H\x88L\x10\x8dR\xb4e\x92\x12H\n\x12\x92\n!dD&\x85B\x041\x0b\x16QQ\xc0\x81\n%\x90P\x10\x05\xe0\x86a!\x11ba2\x06I \x81\x1421\x029f\t `\xc9\x00\x11K\x08\x11\x11\xa0\x88\x914 \xe4Fe\xc0H.\xc9\x88\x11\x83\x82\x01b\xb0$'
a = 2
b = 2
result = BitUnpack(v, a, b)
# print("Result:", result)




def decompose(r, q, gamma):
    r_prime = r % q
    print(r_prime)
    print(2 * gamma)
    r0 = r_prime % (2 * gamma) 
    print(r0)

    if r_prime - r0 == q - 1:  
        r0 = r0 - 1  # Step 4: r0 ← r0 - 1
        r1 = 0  # Special case where r1 is 0
    else:
        r1 = (r_prime - r0) // (2 * gamma)  # Step 6: r1 ← (r' − r0) / (2γ)
    
    return r1, r0



def use_hint(h, r, q, gamma):
    m = (q - 1) // (2 * gamma)  # Step 1: Calculate m
    r1, r0 = decompose(r, q, gamma)      # Step 2: Decompose r

    # Step 3: Adjust based on hint
    if h == 1 and r0 > 0:
        return (r1 + 1) % m           # Step 3: Increment if hint is true and r0 > 0
    elif h == 1 and r0 <= 0:
        return (r1 - 1) % m           # Step 4: Decrement if hint is true and r0 <= 0
    else:
        return r1                              # Step 5: Return unmodified r1 if hint is false

# Example usage
if __name__ == "__main__":
    # Input values
    h = 1               # Hint
    r = 8904416         # Input value
    q = 8380417         # Modulus
    gamma = (q - 1) // 32   # Gamma value

    # print("Input values:")
    # print(f"h = {h}, r = {r}, q = {q}, gamma = {gamma}\n")

    # r1, r0 = decompose(r, q, gamma)
    # print("Decompose result:")
    # print(f"r1 = {r1}, r0 = {r0}\n")

    # result = use_hint(h, r, q, gamma)
    # print("UseHint result:")
    # print(f"Adjusted value = {result}")




def w1_encode(w1, q, gamma):
    w_tilde = []  # Initialize the encoded byte string
    max_value = (q - 1) // (2 * gamma) - 1  # Calculate maximum value for coefficients
    
    for i in range(8):
        packed_bytes = simple_bit_pack(w1[i], max_value)  # Pack each polynomial
        w_tilde.extend(packed_bytes)  # Concatenate to the output byte string
    
    return w_tilde

if __name__ == "__main__":
    w1 = [
        [9,9,6,14,12,4,2,5,14,8,3,10,13,6,0,11,14,3,5,11,9,5,6,8,9,12,3,2,1,10,10,10,6,14,13,7,8,7,2,14,5,15,5,13,6,7,11,12,6,1,9,13,8,5,9,15,6,2,12,14,7,5,13,13,7,9,12,15,14,9,12,6,3,8,5,1,2,1,7,5,10,12,6,12,14,14,1,8,10,7,4,8,5,5,0,0,12,4,8,2,9,9,2,6,13,10,8,7,3,10,13,1,4,5,8,8,15,5,9,3,10,1,11,9,6,4,12,0,5,8,9,11,12,5,11,2,13,4,13,10,10,9,12,7,13,9,1,7,2,13,15,0,7,0,7,9,14,6,9,5,7,1,14,5,7,8,10,14,9,8,3,0,0,13,15,9,6,2,10,6,0,9,0,6,11,10,12,11,3,12,1,14,6,14,10,9,10,11,8,1,9,2,10,4,13,2,5,7,4,15,11,2,2,0,9,6,15,4,8,1,4,1,8,3,5,0,5,9,2,13,13,7,13,2,1,15,15,14,7,12,0,8,12,15,6,3,11,6,11,7,5,1,10,0,7,5],  # Truncated for brevity
        [8,12,6,2,12,13,8,4,9,14,7,6,12,15,10,5,13,1,11,9,0,6,15,14,7,10,7,8,0,6,6,8,1,13,0,1,4,6,9,5,3,9,6,7,15,0,12,3,9,3,10,9,3,7,12,12,10,6,5,13,13,1,9,7,8,15,4,5,0,14,13,8,13,1,14,13,15,11,6,12,12,4,10,12,15,0,8,11,4,2,7,3,2,0,14,6,2,6,9,5,6,8,11,8,14,5,13,4,13,9,12,11,14,10,15,11,3,11,6,1,5,5,12,8,0,2,9,6,7,5,14,7,7,8,13,14,13,12,6,5,4,3,3,1,15,9,6,3,13,10,5,12,3,11,0,0,5,5,13,9,0,13,9,6,2,6,15,2,3,8,8,5,15,7,8,2,0,0,8,15,8,0,1,8,0,9,7,8,9,8,0,10,2,7,2,11,0,3,5,2,10,8,13,10,11,3,12,5,11,10,0,6,13,12,11,8,6,11,14,3,8,9,11,14,5,9,2,13,3,13,11,8,7,13,5,10,11,0,2,2,14,7,12,9,7,14,11,5,5,7,14,12,5,9,2,10],   # Add all coefficients from w1[1]
        [0,0,6,5,10,8,15,10,9,6,0,3,14,15,13,7,5,13,10,4,13,8,11,2,5,6,6,2,14,2,5,3,8,11,6,6,13,11,9,5,6,15,11,4,10,5,9,1,4,5,5,15,10,14,0,14,3,5,13,13,3,13,12,7,2,9,4,6,7,0,13,9,10,1,15,1,2,12,10,12,14,10,13,0,6,7,12,4,1,9,4,8,0,0,12,2,9,1,10,10,1,6,12,11,7,6,5,9,12,1,4,4,7,9,13,3,10,1,7,1,10,4,4,4,5,12,5,15,0,9,3,6,5,8,5,6,2,9,12,7,1,1,13,3,10,9,11,12,11,8,15,5,2,10,1,13,3,1,2,5,11,4,2,14,5,4,3,0,8,5,15,13,10,2,14,2,8,13,0,2,15,14,4,7,11,4,9,10,2,14,2,13,2,11,8,5,9,10,2,12,5,10,1,15,4,3,11,10,14,12,9,2,15,4,12,13,0,5,0,15,9,12,13,9,2,13,9,11,9,6,5,11,3,14,7,12,4,12,8,7,10,15,3,14,11,11,5,5,10,8,3,5,4,8,10,14],   # Add all coefficients from w1[2]
        [0,13,4,4,5,14,3,6,12,7,10,1,5,13,7,1,4,2,3,10,15,10,11,4,12,14,14,12,9,9,0,5,8,14,1,1,7,1,6,15,15,8,0,7,9,7,6,9,15,7,0,8,14,6,1,13,13,1,5,11,8,7,8,5,8,14,1,0,5,9,6,13,7,7,14,12,0,4,10,8,11,8,4,11,12,14,3,7,6,8,2,2,6,6,9,13,14,12,15,4,2,9,1,0,5,1,4,7,10,6,7,15,7,11,6,1,1,13,0,8,8,6,9,10,3,9,2,11,15,12,5,2,5,8,14,5,4,3,7,9,11,5,14,15,9,6,9,4,11,7,4,4,13,13,9,9,4,13,13,2,10,6,11,14,3,8,0,13,15,11,12,2,4,12,0,3,8,12,5,12,8,5,15,0,1,4,12,10,10,11,10,11,0,7,5,10,2,0,5,2,7,11,12,9,11,2,12,2,13,8,11,8,10,7,10,7,0,5,15,10,13,9,2,13,15,1,7,12,11,9,9,10,11,0,6,6,10,15,0,5,15,6,11,9,5,11,14,4,1,9,14,6,4,12,10,5],   # Add all coefficients from w1[3]
        [6,8,11,10,5,6,0,11,14,11,5,3,1,5,14,0,1,4,3,2,9,2,2,10,6,6,13,15,8,15,10,14,5,7,13,13,6,7,11,12,14,9,9,5,0,5,1,15,14,10,4,14,15,5,13,13,15,1,12,15,6,9,12,6,11,8,5,1,2,1,7,13,10,12,14,12,14,6,9,8,2,7,4,0,13,13,8,0,4,12,0,2,9,9,2,14,5,2,0,15,11,2,13,1,4,13,0,0,15,13,1,3,10,1,3,9,14,4,12,8,5,0,1,3,4,13,11,10,13,12,13,2,10,9,12,7,5,9,9,15,2,5,7,8,15,0,7,1,6,14,9,5,15,1,6,5,15,0,10,14,1,0,3,0,0,13,15,1,14,2,2,14,0,1,0,14,3,2,12,3,3,12,1,6,14,14,10,1,10,11,8,9,9,2,10,4,13,2,13,7,4,7,11,2,10,8,9,14,15,4,0,9,12,9,8,11,13,8,5,9,2,13,5,15,5,10,9,7,7,14,7,12,8,0,4,15,14,11,11,6,11,15,5,9,10,0,15,5,0,4,14,10,4,13,0,4],   # Add all coefficients from w1[4]
        [1,14,15,6,12,15,10,13,13,9,3,9,8,14,7,6,7,10,15,0,8,6,6,0,1,5,0,9,12,6,9,13,11,9,6,7,15,0,4,11,9,11,2,9,11,7,4,4,2,6,13,13,13,1,1,15,8,15,12,5,0,14,5,8,13,1,14,13,15,3,6,12,4,4,10,4,7,0,0,11,4,10,15,11,10,0,6,14,10,6,9,5,6,0,3,0,6,13,5,12,13,9,12,3,6,2,15,3,11,11,6,1,13,5,4,8,0,10,9,14,15,13,6,15,7,0,13,6,13,4,6,5,4,3,11,1,7,1,6,11,5,2,13,12,3,3,8,8,5,5,5,9,8,13,1,14,2,6,7,10,3,8,8,5,15,15,0,2,8,8,8,7,8,8,9,0,0,1,7,8,9,0,8,10,2,15,2,11,0,11,5,2,10,8,13,10,3,3,12,13,11,10,8,14,13,4,11,8,14,3,6,11,8,1,3,6,5,9,2,13,11,5,3,0,15,5,13,10,11,0,10,10,6,7,4,1,7,14,11,13,5,15,14,12,13,9,10,2,8,8,14,5,2,8,7,10],   # Add all coefficients from w1[5]
        [1,6,0,3,14,7,13,15,13,13,2,12,5,0,11,2,13,14,14,2,14,10,5,11,8,3,14,6,13,3,1,5,6,15,11,4,2,13,9,9,12,5,13,15,2,6,8,14,11,5,13,13,11,5,12,7,10,9,4,6,15,0,13,9,10,1,15,9,2,12,2,12,14,2,5,0,14,7,12,12,9,1,12,8,8,8,4,2,9,1,10,2,9,14,4,3,15,14,5,9,12,9,12,12,7,1,5,3,10,1,15,1,2,4,4,12,5,4,13,7,8,1,3,14,5,0,5,14,2,9,12,7,9,1,5,11,10,1,3,4,3,8,15,13,10,2,1,13,11,1,10,5,3,12,2,14,13,12,3,0,8,5,15,5,2,2,6,10,8,5,0,10,7,6,4,15,11,4,9,2,10,14,2,5,2,11,8,13,9,10,2,12,5,10,9,15,4,11,11,10,6,4,9,10,15,4,4,5,8,13,0,7,1,4,13,9,2,13,1,3,1,14,13,3,11,14,7,12,12,4,0,7,2,7,3,14,11,3,5,13,10,8,11,5,12,0,2,6,8,13,12,4,13,14,11,6],   # Add all coefficients from w1[6]
        [12,7,10,9,5,5,15,1,12,10,11,2,15,10,3,12,4,14,14,4,9,1,0,13,0,14,1,9,15,1,6,15,15,8,8,15,9,15,14,9,7,7,8,0,6,6,9,13,13,1,13,3,8,7,0,5,8,14,9,0,5,9,6,13,7,15,14,12,8,4,10,0,3,8,12,11,12,6,11,15,14,8,10,10,14,6,9,13,14,4,7,12,10,1,9,8,5,1,4,15,2,14,7,7,15,11,6,1,9,13,8,8,8,14,9,2,11,1,10,3,15,4,5,10,5,0,14,5,4,3,15,9,3,13,14,7,1,14,1,4,11,15,12,12,13,13,1,9,12,13,5,10,10,6,3,6,3,8,0,13,15,3,4,2,12,4,0,11,8,4,13,4,8,13,15,0,1,12,4,10,10,3,10,11,0,15,5,10,2,0,5,2,15,11,12,1,11,2,4,10,13,0,11,8,2,15,2,15,0,13,7,2,13,9,2,13,7,9,15,4,3,1,1,10,11,0,14,14,2,15,8,13,15,6,11,1,5,3,14,4,9,9,6,14,12,4,2,5,14,8,3,10,13,6,0,11]   # Add all coefficients from w1[7]
    ]

    q = 8380417     # Define q based on your context
    gamma = (q-1) / 32 # Define gamma based on your context
    encoded_bytes = w1_encode(w1, q, gamma)
    # Convert encoed bytes to hex string
    hex_string = ''.join(format(byte, '02x') for byte in encoded_bytes)
    # print("Encoded hex string:", hex_string)