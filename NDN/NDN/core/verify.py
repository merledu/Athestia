from key import *
from sign import *


#---------------------------------------------------- STEP 1 ----------------------------------------------------#
#----------------------------------- FUNCTIONS -----------------------------------#
def SimpleBitUnpack(v, b):
    c = bitlen(b)
    z = BytesToBits(v)
    w = [] 

    for i in range(256):
        bits = z[i*c : (i+1)*c]
        w_i = BitsToInteger(bits, c) 
        w.append(w_i)
    return w


#----------------------------------- pkDecode -----------------------------------#
def pkDecode(pk):
    rho = pk[:32]
    t1 = []
    y = bitlen(q - 1)
    b = (2 ** (y - d)) - 1

    poly_size = (len(pk) - 32) // 8  
    for i in range(8):
        start = 32 + i * poly_size
        end = start + poly_size
        t1_i = SimpleBitUnpack(pk[start:end], b)  
        t1.append(t1_i)
    return rho, t1



#---------------------------------------------------- STEP 2 ----------------------------------------------------#
#----------------------------------- FUNCTIONS -----------------------------------#
def HintBitUnpack(y):
    # print(''.join(reversed([a[i:i+2] for i in range(0, len(a), 2)])))

    h = [[0]*256 for _ in range(8)]  
    Index = 0  
    First = 0  

    for i in range(8):
        if y[omega + i] < Index or y[omega + i] > omega:  
            return None  
        First = Index
        while Index < y[omega + i]:
            if Index > First:
                if y[Index - 1] >= y[Index]: 
                    return None
            h[i][y[Index]] = 1
            Index += 1

    for i in range(Index, omega):
        if y[i] != 0:
            return None

    return h



#----------------------------------- sigDecode -----------------------------------#
def sigDecode(sigma):
    # print(len(sigma))
    bl = 32 * (1 + int(gamma1 - 1).bit_length())  # block length for z elements
    cl = Lambda // 4  
    # print(cl)
    
    c_tilde = sigma[:cl]
    offset = cl

    z = []
    for i in range(cols_l):
        
        xi = sigma[offset: offset + bl]
        # if (i == 0):
        #     print(xi.hex())
        z.append(BitUnpack(xi, gamma1 - 1, gamma1))  
        offset += bl

    y = sigma[offset: offset + omega + rows_k]  
    h = HintBitUnpack(y)  
    # print(h)
    # print(h)

    return c_tilde, z, h



#---------------------------------------------------- STEP 9 ----------------------------------------------------#
#----------------------------------- compute_w_approx -----------------------------------#
def compute_w_approx(A, z, v_c, t1):
    z_ntt = []
    for i in range(len(z)):
        z_ntt.append(NTT(z[i]))
    # for i in range(len(z_ntt)):
    #     print(f"\nz_ntt[{i}] = {z_ntt[i]}")

    v_c_ntt = NTT(v_c)
    # print(f"\nv_c_ntt = {v_c_ntt}")

    t1_ntt = []
    for t1_i in t1:
        scaled_t1_i = []
        for coeff in t1_i:
            scaled_coeff = coeff * (2**d)  
            scaled_t1_i.append(scaled_coeff) 
        transformed_poly = NTT(scaled_t1_i)  
        t1_ntt.append(transformed_poly)
    # for i in range(len(t1_ntt)):
    #     print(f"\nt1_ntt[{i}] = {t1_ntt[i]}")
    
    Az_mul = []
    for _ in range(rows_k):
        vector = [0] * coefficients_per_polynomial
        Az_mul.append(vector)

    for i in range(len(A)):  
        for j in range(len(z_ntt)): 
            for k in range(256): 
                Az_mul[i][k] = (Az_mul[i][k] + (A[i][j][k] * z_ntt[j][k]) % q) % q

    # for i in range(rows_k):            
    #     print(f"\nAz_mul[{i}] = {', '.join(map(str, Az_mul[i]))}")


    c_t1_products = [[0] * 256 for _ in range(len(t1_ntt))]
    for i in range(len(t1_ntt)):
        for k in range(256):
            c_t1_products[i][k] = (v_c_ntt[k] * t1_ntt[i][k]) % q

    # for i in range(len(c_t1_products)):
    #     print(f"\nc_t1_products[{i}] = {c_t1_products[i]}")


    w_approx = []
    for i in range(len(t1)):
        final_poly = [(Az_mul[i][k] - c_t1_products[i][k]) % q for k in range(256)]
        w_approx.append(NTT_inverse(final_poly))

    return w_approx



#---------------------------------------------------- STEP 10 & 11 ----------------------------------------------------#
#----------------------------------- use_hint -----------------------------------#
def use_hint(h, r):
    m = (q - 1) // (2*gamma2)
    r1v = []
    for i in range(256):
        r1, r0 = Decompose(r[i])
        if h[i] == 1 and r0 > 0:
            r1 = (r1 + 1) % m
        if h[i] == 1 and r0 <= 0:
            r1 = (r1 - 1) % m
        r1v += [ r1 ]
    return r1v



#---------------------------------------------------- MAIN FUNCTION ----------------------------------------------------#
def Verify(pk, M, sign, ctx):
    if len(ctx) > 255:
        return False  

    M_prime = (IntegerToBytes(0, 1)) + (IntegerToBytes(len(ctx), 1)) + ctx + M

    # print(pk.hex())
    # print()
    # print(M_prime.hex())
    # print()
    # print(sign.hex())

    return Verify_internal(pk, M_prime, sign)  



#---------------------------------------------------- Verify_internal ----------------------------------------------------#
def Verify_internal(pk, M_prime, sign):
    # #--------  Step 1:
    rho, t1 = pkDecode(pk)
    # print(f"\nœÅ : {rho.hex()}")

    # for i in range(len(t1)):             
    #     print(f"\nt1[{i}] = [{', '.join(map(str, t1[i]))}]")


    # # #--------  Step 2:
    c_h, z, h = sigDecode(sign)
    # print(f"\nc_h : {c_h.hex()}") 

    # for index, poly in enumerate(z):
    #     print(f"\nz {index} = {poly}")

    # print("Hint Vector (h):")
    # for poly_index, hint_poly in enumerate(h):
    #     print(f"\nh[{poly_index}]: {hint_poly}")


    # # #--------  Step 3 & 4:
    # if h == 1:
    if h == None:
        return False


    # # #--------  Step 5:
    # print(rho)
    A = ExpandA(rho)
    print(A[0][0])
    # for i in range(rows_k):
    #     for j in range(cols_l):
    #         print(f"\nA[{i}][{j}] = {A[i][j].tolist()}")


    # # #--------  Step 6:
    tr = compute_tr(pk)
    # print(f"\ntr : {tr.hex()}") 


    # # #--------  Step 7:
    mu = compute_mu(tr, M_prime)
    # print(f"\nmu : {mu.hex()}") 


    # # #--------  Step 8:
    v_c = SampleInBall(c_h)
    # print(f"\nv_c : {v_c}") 


    # # #--------  Step 9:
    w_approx = compute_w_approx(A, z, v_c, t1)
    # for i, poly in enumerate(w_approx):
    #     print(f"\nw_approx[{i}] = [{', '.join(map(str, poly))}]")


    # # #--------  Step 10 & 11:
    w1 = []
    for i in range(len(h)):  #
        w1.append(use_hint(h[i], w_approx[i]))
    # for i, poly in enumerate(w1):
    #     print(f"w1[{i}] = {poly}")


    # # #--------  Step 12:
    w1_encoded = w1Encode(w1)
    # print(f"\nw1_enc : {w1_encoded.hex()}") 

    c_h_star = compute_commit_hash(mu, w1_encoded)
    # print(f"\nc_h_star : {c_h_star.hex()}")


    # # #--------  Step 13:
    ch_chstar_check = (c_h == c_h_star)
    return (compute_infinity_norm(z) < gamma1 - beta) and (ch_chstar_check)




pk_hex = 'EAF0686CF7EA3FD1C864B91466101F727709D27C141725F0A0338019BF7A5D821719E3911BFEBAC00E65077E2C25D79707516BC2744A6FFA903305F8BE1193C78F5E7DF7D5BF239FAEBAEB0005B732CCC0A5B61AF06DFE8E5B5FFF1B9DE15CC40DC74A627B33D61245F1F7963D6569B73760370DD81DB0DEB1C3756FE099C5F8EAA1B0A8E02054016BEB023E2E60906E5F4B44B951AC3CC2061451E57343DB7C1D7EA6B72B5E96454D038B29DD253C5ACA8E5936F323FC0D08F744C0686A10A92001DBE327DC095ABA9679470ABB0AA21BDF17F2C753059C34E76E8C5090D09BC06143BB3FEFC687846912AF59BDE7826DC211FDA4B98B5F1B83C36A7FCA9F2C84A3C19EA70A11CDB7562C7B45585AA0AB296D9805BE1B217D89956356651B16DB10B7240C75696BC6AC3C04374381F43B88EE4D2ADDB6FA1F2B6B38CF24951DECE9B6A280AEC2680986C7B00A771D0BD7A797B490192A585A00DE021C62F6304DD3C4940456D5E33420FDBE3E8202A87FD2D12A1865BDE4C27B2958CC338535674533FA3BD5E9728D8C73AFCD53E5CC1FD515DCD5AD62B1B7864064FBFDA09348E86AE7650903097A5121AB9C5CFA9DD87BD8D1DFF917E4C204785FCD8976121D3FAC222A00F235F2F03C6E8AFF3E7490FCA113C529C295CFA856F6EF02FDF4586DFFC58EBF0E8E0E04FB77AA24B99171F6317D4473682A839A2C1C87DC3287BF7187779DFD4D4AB90420BEE666C8260548DA31F7AC40925426FC3C8234C0468A90061F2C61B41F4BB3145AEE694A800F63380886B39D87FBF76BEF6164BF383A2B6669B7365434D096CF29725B132B060906F2357F1928AFA633FC15B331CBECBFDB52758F7B08A8B3EA9306437F3823FF88B7C55215327F5A9AEBB057337314C42C5DB5DE2067A18A4D85B754340A742CBA6FD8F8F99A9F90FE38ADABB151EF7904D0C775A84762109F12F652CCB785FC4AB6BB3F8DDD85A11313F1DF8D63C66E91E81FF8F2F379AFAC9E32755F798123951216F86D0DD9842B9C7C7FA7C6592F7E43E3A9E051D450D64463291A7DB46BCDE05069BBD41E341E28D9F35846C4F4EF3F63D60E41E72D43EED1B346C22B1D43A29756E85352D41C4034676892B570BA51064A050E96F8E6A358CEAEAA433E898E8EDE455D08D120F2383DD380C99C6A8C853C3845573E1CEFA17F294C5E22C000D778467EB8A9492A9D733628590F4289FAE4830E00B67CF39208407289D527F8AB134740FB0C2FEA002669C9E40D85790C4A09E9D91B55F5B425BFA2C1F87C2781313C9977C3966E4378CCDD6E800AF42A413A86659ECF39A2587EF38223A839262B753CA1E4E2AB986BF4633D06F255DB9D8D7CE07AC348711D33CFC648DEFC0379B17E93F15E25C7C78B8490334950A4E4218918B992684247D1296D433CC696B0F5784C5D0AD234FF7EA878BD51A7D04E3E34FD10F3B1EAB904F39D7F4919EBBEE37A7A2A3236D7D616F255677627E17F9AFC89E142012C045435CABED6E03C5B747AB354301A0AB804F995067FB25485EAF70E924FEC1F8A8E72648658B051A53A08259B4F303C2D78D2FE7F06B6DC7355A4B08362F9F4C02DA3BCAD2861FE61A7642092F79A122ACA994F83FE04851649B5C1D5DAA6635CB483C26C4C765890612FC17E2F39FCC9A40D4034CE2F3D99AC97908E49DEA1A74C388D41C09A060BE374405BD6FA95E2D37597F289D60D7FB7CA1F0DA3560885C4DE1CBA9427DDA3F4E0A2F2F806E496C66324D585CCB5EFE25C5CAC43FDC8C1AFEBB32464A16A0A7C24D3ABF1C9463AB94B5198759D4047A708D8E794265D1D7677B77AF657BDDC4C6570A5E34D835727BA5A21508ED6D98B332468A49819A173D6D6DC50043862561BFDE8B3A6F31115DFCB50C06126CDE23E5E5C4F3E929D39EF1A86DF14CA1E7B40CE2CF80D99503BB7060D6D5DA99DCD56212094D225826DE31FB91331E24A67A7CF31923099FE1F1C2DA3B96895A37DD77A5F6A41690DBF7ED865286968CFAC7708DA0D18408F745370356D08D410C01881A18ADAE1EC0B01DB829C9E5839D3308ABE805BD690AED6B5FC21E7DE8021B1AAD646025280925E060C13ED5E4A5F9BD743AE7591005C395474DDC780672ADE598EC68D5B113880CD29AFAB03EAF89ACB92D783B1138797286488299AF5997FB6597C035019C02E2DD642B733EB3FAF8439EA1FD59DE519DC5ACB0BCCBEEB10D56A19A196ACC54AC2403831898063BC58A0B3F3F6F8A7704A866F7D82E68B50E2B3F2A67D8959C969A92907782FA93E626580AF713CCD2C64F60142DB630269755975DCD2014D4FE81D4DCCC0B4276CDD459EC49DD765BB45360366F35EE51D0B09DB0AD262740FF071EF34B1714EEB04B317C6FF2EF39E3C779A53E5CE7A2C1A857C7FE26F5123631CF1CEC5B4C455E08405A4CA389BAC98374EBACC92B8AEFB65F5D2132E1EA0674D52D51AA6431CD27D1FAA613439A701C187C373C1F122DE8206595BC8D8E0277BDEA844032C0C8FE81B2160B3A6FA87A805C5E505779A5D5C2D75C9F974EF0D3D84D8D27DF66178D357294D02D909BD8A599B6B32969E1B95160013AA275709885FC2532AC9FAE544C8B61916C79A41B6D8A623B501D0E32BCC155FB1E6A422941022E835590DBE22C57472DBB2DB323979B7CE200EAFAC333843214BE4B447482C95EAB2FE44F2161C92C52DFA94F7005CE6B6EB7A4899CE1198D3B027A6A0B1A3B82D2489778BC54BCE6001E5DCA27CD12623F0C8C942FC9F4B08875F5C0A2A719610A5466BD9DF8A82AB1F80CB0BA43E9C70FA642BDDDC5AAB0F69BA7FE71C1EBF5952D9E837AFF8A3F046C7BA88AC89B229019F4863D5C804010C6734C894559ADD5C842260B9C26592FEB636BD2EEB34B6171D15A566EDAF3B38A5D81909E687FE8A5A000AF66899E66BE21B60FFC4CD496D4E901225F68EC1DDD97B6921DA667348E39B1F6D2E6FF5DB51D9AD4C9E2AEC95F46FF8B29E41DDA5F4683D27133DD39126903B30ECAF34CDED2DA700A5586A050127BE2FFBEF161F3D09FBAFFBC841BF919904EACFC2069C6780D41F4CB233856A861B9D1CAF9870007CA1BACF8441052A7E3B8AD4FAC77A53EF5FB66E7812C41FDE140483E379D03F1E01FBC3ADE1EED2E0452C8CD64673104D513270CD84CC9F9A2D6F9720E81A4EAB075DBC53C3733753AA9E70B45F35F38BA6B3A72E9ACFC9A5DD0C52AB897C079DA07A9DADDEF1EC21078B59C58398F347D4A90018CB731E4FCB022E36FF4DA180A6FD222F3222CEC409450A4E0DFF8795F99C79DA08FE6BD6F22256CFE24E913CA075684DA425759E2E11C7D5BBC1C8BBE327CA57011D36D21E9D7E768C9A824B3430392D9560EB59A3C126AB17F403D396798619375AD8747949886D5D0D4D73C246A3EF736B769A3A9868ADBBAC355074D64A63553AEF794AAAE3D9504183967BCBD5826A43D232CA5413C90BF2FF8225D3991D7D696F3C91DC98CDAF31173063E58327EEB2E2D94824EE9FAB022DDCE392C880E522BFB6D50025199B61C2D5A2D3D2F3E8998E0A023B926691656BBA13658E7711FC8445E2C4FC091F7928FE45CE13CB148AE87E6598463F4B0B3A120F48E761E30272643708C99594A5F02CB63A8AEB4CA5420C1B94E58BF7C0BEE6'
pk = bytes.fromhex(pk_hex)

m_hex = '107B220CC660FC7710D2F103B72B8905F4A8E69EDA5F67A9513D26D3A4CE70BADCDDC71F10ACE038619673B47E87C4C99041659F6EFB35D89A33B9A6985E0E8387708B7CF51946594755990F3701DC0AE4BF32B352F72B6759BD395706288DFBA6ABB65B92A989C2F4B7969A628E95D38BBFCF2659B52F3DCC1D257EDC3B11DEEFFC9ECDD568CAB3E68B688235F8847E3B159318077DF744798BC35C5D6F4E5D39CC92E70CD1E91ED8D6A451FAA8C9907A82EE2B984BAB81E3AA9EBE86A28A8ADD632AFF88FE002A402B64B2FFDBEF18494AFFE7FA2BC064CB1AE60CFB29493C88A32CE9C013DA7A69E85658B0769CC9B79AE7D0DF132E094CEB1263796A12978314289BA4A6B2311ADFFA28350C50DE7D5F770EC1CD51B13FD0907345F55964108C6501541A282EA8A99D30C56DDADD5F5858D2CE2324E9167DB6CCD55BDBB80FC09510EAB036D6314532E5B6672FF59D66CE20AD6924A69C4FB18AF05A74DA8E5497F46278432E79063BF3C9C038C708A7274936690DA7B4F8882DDEAFDC6D39FCA6EF2F379CC5B0058ABB10D99E257D903ACDC7AED63444C72CFF3DF33303C14CCD68E6B5584274EEF80D9E516FE1F7C62112B39DB906648CA5877A11B3A812290C7FBA96EC9EA2ED6B81B53BC1EA4EA611F19B462CCECC87FED254FA30E070AD485F3CBD8708B8BC58E06B868E635EF982AAF124555B88493D429FA45BFACDD707439E20E4D1510215F0A1B5170ACA9D77AFF5FDB778F0E77F208ED90BCEADF99582905901D6A977A8A89C46420869CC1BAA7308F4635A989D9FF68D48F9ABB236E3BE80D7E548EAB8E96011108E8676ADD7D2B780E4DC5403673F49C0616109BAACD4C97E17A4EE61F3EDD1B75D00DCE9B6EFA902655F0BAC3D977BD3AADDA5BA186E116A702D9D81D41CDFEF89919AE312F39E071C2228BD3E39ABB425C27ED3DD5B49F8E4EEDD55F7C5248E1C49E6E94BA19628B083156266F5594D829447F9ABFC39707BE684A91C4F8B32848FB397862E486DBC29CF17CBC5DE6998F9A482F8A91DCFE16C17940E5352809AE127455EF14627163FA2C8CC1BDC927A93FC6FCF2513ACD41189CD555FAC5FF29B32A85758FC956974A70B56F2E16A3A6CF3BBB2451CCC897F9E5A87B09BBE4AF9BBAD8517FF6D4EAFB5ECF29C2C726B107DF11DF758AE49B8BF57C64B441E6099A782644D7BB85E11B20AF3658448D764A6CBCFFC58F17B20FA01CF5D7E01BAA95176E403D712DC4DED76E9D4CE44B98FB5454CFEC8B2108C863B5F58054B879BDFC2A93ED78CA9F3CA97AE697E025C5A59D5A9069C996BFBB4BC8F8005A7E49CDF67D62A9E13645F4BE99833ADC54816BC65FFE9E86602B5EC47513BEBF4DC63CA5C2EC61818BF59BF926C9F4E574306F87B75E20AAFF80D2EEE425D6C23F1B789E68AF1CB409132470A99E17430A42FA5BD5FDCAC6649554DFA07AA4B07635873E1D0F286E8C3575722495404460835988D64CF7B64995AD911D98F98E954905E9D277C663DBD0A8DDA4146C0236627899F939F97C1F59B5E373043F25032996809776B6E91D52C2DFC917100F7910955CCE0CA82BD9AD608950E3C69EA061E4C413D512DBBF4696A165C3297FE316C73992EF96F7EDAA65BA42762FB3F428A2E2870316405A383C64F485D63F57B30F80A7BAC753547BC72A256D03FBAB9B274C027132F2977EF46A32EB63B4D49B275661DB4F2B74B563B9F5BDBF4E927F50584ABACA7F09616BF6E63C08B835CCD7E4BBA66AFBF361F6DCF03C53F365DAA64BA39971BC7FD30CDCD7329D7B8253F659B1252948BAF3F1BC674A52163E333973B79B1C3C168909E4EF25FFE52E6E17425292369F5E5DD6CFC5884589B7FBF2D727BBE9A9A658FBE7C4779691B3B744BCC41A02310A513F9144C2850270DE5C85B7B39C632AEB6C64D340E09DEF2B825A9AB6581471AA8AC42F049512BDCF28B51575CD4601DF632C3E83EB95156E95E9D542C1A983720B7509AE428E179AF8BED605FC7505679D5C5FDB868D2F94627192BCADA67E0EBB01FAC2ADAF3BC307C5010B2987E0289682F93FB83E740647A75D8E511F6009BA0F8DECADABEA869C080A0A83674BB00FE3CC0DA0281E38FE987E8825D7DB11DF94726547E01C6290A967C677729EB63F73563C213F9E2C74C5CCBA1E7B2003DE817D222D7B33662FFD4D4E54930EBB528D0355DBB9935CB6AFE07B464C6FDDE7BC59762DF14342D931E5B48C44CC654112F67E5907C037F7AB1360CE0C9815B1C98320F84FDE48FB5C6D9BE18B07CA00BE87DE5221A76AED51C60C3A4EAF36CDD74F840EDD13D8F1589FF072AD89BDB75DBF6D4355FD015D920E1C18DFA19B5CD0396B48BF17C02BCB344F22F50CEB6DDEDBDBD9FC1707428843269D4F943597C2F58F98E79C833989695A5D3F8990B8AB5BBD05395E426FD252D54241498525917EBC95C596B99BD115384E76D9955D8567E6C4B9C7167F8B452FA128644EC1A7C136C4E71620922076CC5FCDCDB50203FDA6901B3CE6D84393BBF628EA02AD75060C2BDB995B3C07F1F1A09F5A13374B488B3B01C3C7B3FD126E3252289412276BB9D104F05A8F28B853D2E0D3EAA1D60E2EBCFC2A092EE7111C262883F45BD4E2848A0BE9356A0587651AE2AEC5093886B6468468F4ABE5C5CA4A5A50168DD34681B5ED23389C44A325F0D5EEE4A15B76763F01C792669861AD34858A0D2B883B09D750208FBEC5C80E26CF9D1D82FA5FD4677B9EC8DD1DE1D66CE1FE6452C9E58DE371EF012FDDF1DDCA94B0486EDE8F32E9ECD711061E8BC651505DB09392A2E717FBEC122D49B13E8CA4D758D43326CA9281F705B10D89CF941C4AE11C8E72A1FD948B959921B4E0F2881E9FEE1FD29C317A3F1644A08B93818533E22AB3C6AB34B568B6DF6834D1983BB63C911B44C7FE6594D329B767665B5AFDDDF35D2CA8B4BFAB32E7D101D64D68CDAC16D6FE8F63374F575C8B5AEFE84087E13E823A65E7CD039F9AA80F3DCCF15E74975FB6D34C3C603DB30465C84F45EAE71ECEC7ABED64FBCDAA3ABBC374F26BC2439A25D33796B0063E27CAD38ABDCA467B843028B3A21ECD22EE69FC329E658DE7F076098C567B4EF78B4DFC322EBC1436EE61EA8053B2B9A3B229A2E5A7818C23FD0246C20134DD6EB07C665BB28F5C914FA3B41A898AFA37381AC133DA0F73E1A9BEB17B5D63DAA28C640B4DE9F1BE836D8CE52B7325D2AE7D9425DBD759C2BBCA504D7102BA2E34CF37406C2967CB6DF6A89DACCB3E41E73FB4257B98A9D9CCC034A5B55FA52BFB39A059C51D0262930FCE85B12692F06015AD162EA557D528FC5D6E9C0ADB2C7C59B43FBBAE679455E2DAC37DD2C61A3EC0A0807C2185AF696C082CA158457DD33C587730C1B110A62947A454C1413118FEC6D178AE58C4D0F5016CCF0DBD9D872F84BF03EF18F5A2293ED4F656947AD8C72A5EE5DC9D67EB5C6659C75339D4FE3E0AF93C19F8335DBCAE16164421374EC8CFF8D2BBCB9228C0C8FC1276B2403F4529179DE34398C00D1AB16EC628B45888C089A3691A274598DC7FA2C830686E1CDC3F0889B00F427361FCD3113B05407BC452DF206D0B8421915DE2960C31F9EDC299CB69202CDBAFAA0074AE48E6F6CF05BF0A3A5630A6A7A828A69BAEFC73E69B2BF821C4562ADE9D355103A32C5A47E9818280288519CABB8FBF4AFB78D4FB1427CA932EE050983F32CF7FFB62276773920483E7881E65CF270214EE5A015CA54C75DA93CDD9FE157A0846FAD8E1CD94ADA4FCC58A378A026E6108EE66024779BA48DD3FCC05189EDA0E2F0220C4202FE07AF0917B16FE19A596A8D678D813991A67BF0911BE1F9E3677DC78512F99074771B6799B51E17951EEEDDBA35F16B6867031C9CB67A1A6F48BF35C80500883624C358F8EAA095C218A70C355042A39D46CC859B30B437D014523A4BE0303D2A232DFCD88EB235ED9E4C51EE4B2EC1830A16F9422BAC64219BE7AA1F8E340F6A95576311C5AEB43F0FB14795D5D2B7BF72C87FEF9AD382873FC28742F1449EE6E227C103ED334C8A069415AD33A3E3222A9C642C1AF192565A51451238BAD3245F7B39B9F5E25BD6F59AE12D29DDD885D4BFFDC569FD621BE1B6E5490A4124E7C13F8A0C29B8E22762CD297C0C730D3F9A50535DA19563E9886271D809BEA41E17EEA1371C73D5281D9F5ACCE7EA7D528FEF07AF603CD56276A780FFE000C6BC9A10678AC69D2EA2FFB39977F7DA91086152D8D07B3E2F7E7867D44B16D5DCB71652A778F3DFA568BF82ED8FBA4ECA4BF396D4BCB7DD0F41895A6A6B05EE25ED4354C5C126859E360E90AD8A80B9D9E3D3DA3A3BC21F0BDC14CDFE9215B3F96D0D6E4994319D262DD197DCC3B9230F87EC801FFE5C325C8CE9F75F4CB270CDEB5467AD9041C663F2D8966E1FACF5D4731AB102E39E4DD5BBFF8A5B9590FEC440B688B88E962A38EF63BE4B31ED5B17448DEF4B77B184730DF544BB7AB6C7B124C75C7AC33961626628B367125BCBFF'
M_prime = bytes.fromhex(m_hex)

sig_hex = 'C883516ADEE991A12AB7E5FC58FC426438BAAA45FCC13B5E222380B85A5C0B0FB8DC8AAC10E4CFC921BC7CD18E18A379A539E8CF3FE48F352C43F6AA22C320989F16A7D41B582BDF35531A18CD0345A312DCF86B076E7213247AFCBDDD4942381B97D981502E4DE5668E1E3EF86FA65B3E20E88212AA657B9507DC519FCBD5411A952D8A54518434D10C8D811C7CA871C5FE2932E495C0567ABEAC9221B9A42924601F0AA9ABC1071A1E86321839C7B89ABEB0DF520D35C22AADFEB35C166DCED57B7ED857AFF1F49AA1286840ADA3EF34663E4559B290AE408AD0C8284084DAA1B27444EECC54948AF4F738C68F92ED7EA99118AD8B8B9E9976CBA8DAEF9236B28C6151E0FF931166AEBF417104427D0E3EC52F33A61AE2CDEAB50A182172A50F94581D567B709E9C1E47FCCE492885D99C4AEE94355BDD8AE2A665F5C86141CFFC3AD947083C6388A822E059AA4100F99EF2B73DFBD30AE9F58205B473B77DE96D4F68A3A2B4D03F45F22EB4F50481CF80CD2B7AE60D3EDAC42644A95B4E1782EF4701855B3BAB0BA3FF1A2993EC86DBA723BFB699D56F1D6678A4189B9D197D2C715737AC557E3C91C94FFAD0B37CD2911680D6637A6DDB7E6A3AA62F4FE3A49502753D511B7DDF9C9322BE6FD7E9C8FEF40C89B50EE3B72FCAB674062F5F44072FD867AF9FE3D733C17C519C64291C5DDAB18306DD5AECEBB3B4DB3948FC1D3C9429FBCF39CF0E4BBB7CA7602FE64B9BFF29C075E3BC5D952B41FEE0B8FD73E0FDE3D10E5D9CD21DACF15A68C04F7D10BC1C79257E99F89CAF8803FBE6FA8F6569E2CF2DCB52C502794D4F4434FD905304D67F00532DACDC148C8E28C0003926A05F234358FF3EBF6A5D467A898661BACD00D06DD2181EEC190E6600D60C4F597F3244D2DA6C0BED495203C1CD2CB29E8E1E9999444A800FCCBF9DDE2C902EE9B3FE22ABC0CBF464130F43BB4EB01CDB94B8C91F59AB7DA8C0B44E8034D6B49776D4B7364FB209AD6A29FC7ADA13A38EB5F43E2F917352286004C909C19DBE7D2707AACF4ECF623A85154608A6D345E3086AC53ABACA86C46AEC94D751CAE8020B2F73B9ED9961AFD4682407B107FEE23FD2EE0A72FEA20A0C01ED6F91DC36F8CE216C8F14738B72F7189CF0BF05030E1E428EFBCDDA957BA0E7F3A1C770E0D3F0F49487984FD024892DDC1B77DE81E52477A8AF8065C6817CB2EAC763FB498799936569CB9A75B8D6CF7392A4863C7E8FC4345C2FF52AA0D0004BB7370FD188D5A2D79A7F82F8CAE209361AFCC2D094C5B70AF3D355FA1EB75287D87BBEE38F618C12E50A74B7948243C5A016F17A956DC960C77AD99E7C48A6432F4FFE5263D8F4394B8252486DBD47AA92FA2F902A063D3BBCE2569D5CEC09812882E87F60B1C0AD4DA54F7CE62756F27DB3DC4E4C78FE1E7E947A94AA3C04B0836C576D536572723A5EA12CCC5DE9329DCB988268796E66327666AEAF6F21084D42060B4528A43DA96A77C35B46C568EFDFD4FD715719B5CD025B7335A67E9978F0AF5DDA895672BD77213FC60AA6D23141C20077A2044E26B465C03E476409778093F38203D6EF7D066E6A9F4D7C7CE0EA3E0120CC173318DAC3AB9C844DF1FACA3ABEDC5EC5F87C4EC4FAF2867F11477982D7EC4EF2BFDEE4E7891E4C5FB873CEED9D161BE0C2B8243C4E3A82975E80B8CFED52E1EBBCF896768D331E8A9533ED655637907A5AF009FAA6BE2CB0862B6C98C148B25CC8A9612001C500043E579774A8B4B6CEED219AE9B729BD502E9B15C4B95FAEA817DBEE92D99FAD7E231ACD60AD4D5793A429E1CA43578D35DE0DA661C659E7954BEB5E97D522FD41DC6846625D3BF006DACFE503D3BB549AD641149F1B7CF98961C93ADC2580E241DBCEF17D9E7B61EE5A19DC106BD11FC84FF565F49F853A861A8C5837D95C26888AEDA1B5ADF66D15B1E1297939374B96265363ED9901FB034F87F1A42D8EDA6F2924FA8EE3DE50398086009907663863F93C509BCFB1BA68C53107FF503EBAE2EAD2B00577C283A79C32F5461B744BC6C512DBE058D512627425A6B0C3D68F0DCBF8BEACEA39A51A6EFF464A32106EA05875A6F5370ED6DFB1CEAE6CA3288509FB24870ED4086A34D4257A05D75BD2F7D94775AF2A2C05F0DE79605289D03B9B92719B118C060C2E9ABE6A26CEC59040662CA0F45E9BE16096D9ADFD6983815AC4636732AF0648545B57B267F54931CB9B8D0571819ECBFC338618A560EF39240FF4C33D79EEC160CBDCC1061A042B85AC0D053CB013383B868CE63F2E9690C8526F8E438DE07D58FBC8E3AAC636DF4462A43EAACD31686027F711EBBD7187987661D6FAD9531E4ABBA24176AE3833D00FFA0C14E50E61DD5B83EDB91A597964182E9700821C5495657BDB88F7765EB7BD209F5B633BA8B658C3F3DE3D63E94C4EEFE84054D85978F4C01B6F13A86D73A677A211D87356C83A55AFC3733AF5739F3719B7F7D9AA2C677AA0068EB7CE4A58A6E9EB71DF5B1123B04B4436ED18797818973AF0E32AB8F34041899DE1B4E87CE86B32042CFC89B3BED71F24982EF7855A9EFA1CA6ECA9463081C0A039203C57621EC6DD322318FD14A1CAD324A705FAF90F411013B4669CB388F7FD43CC59B5EEFB2E16F57F8AD5B464E152968B984FCEC86325BAD6F8E996BDBDD8C03BF11ED7AA9704B82C9500666A3E10BCE19BCDE499580FDCCDB979AF707734C1ADFB9DB4785C9ACC0F65F9AEB1B090EF2029566C2ECA3E0743E206D781DC939772CBB75CCC5967B56E62702D4CCC73605FD2C6E9DA18CE9C108315F3B2D7E5B8B2ADA85E63569325CB7205CC0C5B0117A3E3D7770971C1CFBFA9E2DA4ACC82916DA2819F5AEFC99A2BF2F564C4885864D9F3329B9D029B7ABC0385A0F21637BD5F75E04DBC8F1F5D92EAF4B723C4932C222A0512A8C33F06313091F8FFD186695E006059F792120FC1669F32083BEC262A93517AF1083EEE14752482F7F3DD52739680A0282E13C6203D8C4220C8F53E7CE6624C122349005E4657854B6CFF4F8E6EA2CD3156E290021CDAEB760BE2FF34C4F4E8FF46C9138C5B55242E9FD355FC5556C4DD211514772FE90BFB6521A9EC0764EE6664CF103E8CB3AE2119565A938BD0E3503EB98D904CF422DD4F6B957F865B5851F9A130C982FDC51A1EB5D6992BC195E84D3D009974CD4FF042DB8106E8B3D07DE94F7323B454CF4422E92F0C621F5C8146A0CF9692E279EF78C1142A8A2B3589A6D0833EC31BE1EDF16BC810B15DF671F61D116DC70587CE1549D8631F2559D0406A1189903CA73C263DC4D87FACECDBDEE1D62A8CFC5B9A2600E7305D44733FE25C56AD4A175F1EF16BA689640EADA4D0B396D426A0EB4E40850F5F8B15EEBC450F4CD0010C69C460ECCEAD862225537B6EE4E053D5C245D8B38F6610B4E1877E2A70F406A203D52CF6C9E227DA1A4D817D78F079D9B04C4E80B10D5B870AE4B908FC9C38850D29D3E1413659DEFD75E55B1FEA868EF7C49FFC43E855974083050042B4D72D915C924AE83E671F92C2BDB2ED23DC9B34832C9EDED134A107ED321A42F46ED99007834907A1EA4E9C37A18528DC9BD23DB7371AF48CE1D9184CE4A8A82309507122DE7667E0BD40A11C66D86124A4D48E182331C613E18DEF7B5372348295763E3412247A9D8B142D9ED707426211A49E70D48AF13975773066565CE3472716ED2413431F0A1BC36DEB5A784C306A29EE1BEE261F51F2E97F1F06EFC57B985F56CA0365F47A196C48EAEFB83EBC1027FE2132BD2DB7DC0F9E557A5F535DDB48ECA41BC9E01656D3E4513D5968B072D64C30EEA5E72065D33D5C6465E5B8AA53068FF9566902A9F1373B366ED1E5A9CDC3499F540825D7BB5A5CB2E40ECD09BD693EF9F021EBE346A71D166220A36971936B6FB04CFE37F4B2E2FDAB3094D03C9A0F5D8AD1433369426FD352278903DCDC31BA41B7E981236BF53A830A67060D7586CC5D0A5BF622B297122C746884C101C051C97592204108F470459B22C328D77EEC93BB0601D8D8608002874517EFBBC9EF6127C48E0B39778731AA2DBEFDFF93C9BFD47A13AA189C31D2C1FFD64A267C2CEB4DBADAAED1656E97E4CBFA374E762AB18676CF5F7C24F8E67B470BBF83A08A1C2047ECC478DBD8C1D3F19A2F10D79C0895383148B6BD1346D359591389DF84084D166F24A005333CFB1A26ECEA248AB18E4233F9D3D83B49253CFAF666E2DB49E65E66B43B8C41942A6C4DFF4100C64D9DA5AE48B2284D87E4CB9997E640E7D653D0A658BF14486376C9DB6C2AC27B0E560A92B958A20CE8B4055CEB17F5357FF0E0184EA7B46A5CCCB9F46EEA3FD3BDA7D85236A07A73019728531DBAB8FE25F324436B9C3067234BA05FA4CB227E9AA14E436450CF457FA686A82DCD77A0AC6EE3B6F53C0B8D134FE884D9144F0055E83277E5AF23471D2BCFD1FF2B64190DB0657C6C50C728B59419ACBE6D1C669DE90AC84FF84AC4135A65E94E86333C15EA43838C666191E08DD2A6C004D8E82665DE1914FBFFFC49DC55C1EE2A59F89A920E62D03EDEC78C5AD751DFFEFEFC964E25115911AC4BD1CA93EEEFA33DA30ED4C7BA7DA465BB347BB06A06AA8DFEDDB61BAE053322E06267510383F903954B4DD522D7C49B58B57FBA3B410754EDB93F2FD3D50D22DBFBA0252FF03A2EB95A66CE5A9EDBAE958852AF0E014F378880847844BC75D57F9D1CB624126E90C0CDD8F1022FF447733BB8ECC1CD35EB13F6D41BB89106CBA5EDDEE177F234F717C36DEA9EDCDEEAC034E991CB64E25235BF6C2B70EC0A463134688150A9FE9412395C37608A43558C96B1A86A4C8745CE7383B95AFA00457599DD3092A13C49111501E9D24C9D4754A47F36245E3478AFAB05096D1AC3812F7F8B0161C018D78429A2468BE49C2A6321C694D4A369C154BA8E7838925F8E7AA61325435646D8DF4AC3CBEC7802A83B7A9085699794BDC43B524C9365E6E2FD3ECADE9F33DB5D4FD11FE196DABB18BB10097C86653AE8BEEE5A306BB6F68169B8720649CD12BF190833D596F4828C9DE3EC40D1287679C4C9B0BE933EE267272B9AA8FCEC6A9840B7072FD6C4926B5BA381AB53562A27D2223D63A14EE12076BDD70AE5D21620AC7EEC86163AA8011781FCB6913DB666522F72E248028AAE33D79DA2D6417D7DCE294769FCB8FB597E005CBD3756C3CEE68C761BCCD2E56402498E9185A10BE580C621AA82A72C2B79C17589F2EBDA0C9A8B841145F74EB1998B16706C86ABD7E44F1B2272AC0EDE829921F91F87775E970F2DF654C22D3F0773037A166E86D6CFE85D5B33ABA771F274AA079C2647D9C256E74A53B1FDDA30D85C169DEB45616E4929D51B7725E66331CDF05C4F6CA757E2D3CA4369EFB9B38D9FFFEFC3C3F8DBF8A2A9E8106902C12957336173097367A4B9187DF3DF50398C2EF414CA13DD5B8BB998D2D21C8C94D44C523978AC7DE8D63039B2E28F7FC621360655522B4D98FE4BBE4956C1DA3AE03FF16179310DD37E1254182AB8C183311AA13ABB2E30C4B4AA33316F00E8414FC760B3BD8C9433BC8585615343EEBF966325378A3C73187D70563F5914D476FB3EB3971C7CF26D9551C5AD40B44B6F78B9538778C92DE3E513361FF9584EB2345D9FD60448994F07F5F0B454AC7FEEF9BA5A6EBF6540133C7A7A88BEF5433ABB7449F42A21F7701694EEA0F61BDEC567EE3E19615B78C38AB8CE1F7AF0223DAD7FED526F7DDDC6FBA11F61090EADDF91D90EE772C2BBCB9DAE54361389978EECC113E106E57E0CC9638429BAD9FC570D50CB481BC478B6B073FCB76651EE661904635EA4B5F645EE5AEA1FD1331C7E7AA1657067DA4201A933FAE899863AFFBA0F581E0ED17A7095ED40191707AD2F89D3B677F33557B5D0FBB358D38ADF0A7CAC5589415A2C6103CF08724E15F20C0810CB3E0821D359F69CF1D2CF581797F291B7E34D427CF3BCE9194533AF8FA401448E87EC391782662A921DD316D4F06A7C29D19F82CA3621B0867C6B430158859B3A9070F955FA41C71C8CCA3F63F2F6D9BBB38075AC63EABD3CDE4323E5DC3CF7A572FCFFADABB65F790AC3650D67D307457F38EC662176FFDB41CCAB76B039EF1F082CD562D594CB0FCE7EDD73CCEEF9BD8FFA35AA1F91EE3052C01D35BCC14B41E06B3AF5053BFE58525A70D5C369EC3C2C3627CDC342F02B5B3BEF42F9A0F2EEF063F74B0DF9BC5C845B4ECB0F37EB93888DBDA61A7AFD298909E6C3AF8E8EE01D9ABDC33382474EA1F38EB7B9A8D312BB3067CBAC7ABB72BE64AF5FC70B0A244DD922EB9CFBCB4D4B438F8CF58B3B463F6E95AF0B669C3790B433F4406FF0AAFCCCA93761F23941FF5306E860BC536A7E9F875AAE979869B8DE55AB696F6A51F05DAAEECD18C3C22B9E398412025864828389E2F4FF0E195D62ACD32F5090EE1A8E9F0243565A758AD3F46AA0B3CBEEF25584A1AE0017222F393D4E4F53B300000000000000000000000000000000000000000000000000090F13161E242832'
sign = bytes.fromhex(sig_hex)

ctx_h = 'B3421B04B5FCC8D668E5059FF18F3C16FA8228AEB7E2251D8FEAF7E0EF1A9BFCBC045243052BE48F7855AB75B764320729C595E3A342B6058621309A8B412C135ABD04239765DB8F65CCF16DE8AB3FBF8483211B2EF6B9C027E9A9E1BB4A5B6AC39321F624B68B4BE1C4D95D02DDEF2F02EBE4E7ABEFA77BB328DA22B0BC543F29F44BD7DB41AB696BCD0BD5726DE8020C5A9D0F8A855E0F6BFC38CF20F618EC9A4CCAEBE0FB8AA0FB6E6D09FE1278ECF7FA19C9A8EE8BF4E02CD265E2A7D7D8D609E8EA59E0FD262346FE15793E3B3D611B76F7CFEFF5823624CCDE21ADE7FA84E6473950DA076EF2E9B89E71C218AC0AF412C9A15BBF1E4339C5614FEF'
ctx = bytes.fromhex(ctx_h)

verification = Verify(pk, M_prime, sign, ctx)
# print("Verification Result:", verification)