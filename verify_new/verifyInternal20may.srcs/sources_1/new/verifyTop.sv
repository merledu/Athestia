`timescale 1ns / 1ps
//////////////////////////////////////////////////////////////////////////////////
// Company: 
// Engineer: 
// 
// Create Date: 05/29/2025 03:00:12 PM
// Design Name: 
// Module Name: verifyTop
// Project Name: 
// Target Devices: 
// Tool Versions: 
// Description: 
// 
// Dependencies: 
// 
// Revision:
// Revision 0.01 - File Created
// Additional Comments:
// 
//////////////////////////////////////////////////////////////////////////////////


module VerifyTop #(
    parameter int PK_SIZE = 20736,  // 2592 bytes
    parameter int MSG_MAX_SIZE = 25624, // Maximum message size
    parameter int SIG_SIZE = 37016,  // 4627 bytes
    parameter MAX_CTX_LEN  = 2032
)(
    input logic clk,
    input logic rst,
    input  logic [PK_SIZE-1:0] pk,
    input  logic [MSG_MAX_SIZE-1:0] M ,
//    input  int               M_len,
    input  logic [SIG_SIZE-1:0] sigma,
    input  logic [MAX_CTX_LEN-1:0] ctx  ,
    input logic  start, 
    input  int               ctx_len,

    output logic         valid,
    
    output logic done
);



    localparam d_len = 512;
    localparam msg_len_pk = 20740;
    localparam capacity = 512;
    localparam r = 1600 - capacity;
    localparam mu_d_len = 512;
    localparam mu_msg_len = d_len+MSG_MAX_SIZE  ; //f =4
    localparam mu_capacity = 512;
    localparam mu_r = 1600 - mu_capacity;
    localparam msg_len_c_tilde = 8708;

    localparam MAX_MPRIME_LEN = 8 + 8 + MAX_CTX_LEN + MSG_MAX_SIZE;//8+8+MAX_CTX_LEN + MSG_MAX_SIZE

    logic [MAX_MPRIME_LEN-1:0] M_prime ;
    int M_prime_len;
    

    // Temporary variables
    logic internal_done; 
    logic ctx_len = ($bits(ctx) / 8);
    

    // Instantiate Verify_internal
    logic internal_verified;
    
    verifyInternalModule #(
            .PK_SIZE(PK_SIZE),  //  2592  bytes
            .MSG_MAX_SIZE(MAX_MPRIME_LEN),    // Maximum message size (adjustable)
            .SIG_SIZE(SIG_SIZE) ,
            
            
            .d_len(512),
            .msg_len_pk(msg_len_pk),
            .capacity(capacity),
            .r (1600 - capacity),
            .mu_d_len (mu_d_len),
            .mu_msg_len(d_len+MAX_MPRIME_LEN+4),//for shake =f
            .mu_capacity(capacity),
            .mu_r (mu_r),
            .msg_len_c_tilde(msg_len_c_tilde)
            
            
            
        ) dut (
            .clk(clk),
            .rst(rst),
            .pk(pk),
            .M(M_prime),
            .sigma(sigma),
            .valid(internal_verify_valid),
            .initial_start(start),
             .done(internal_done)
        );
    

    // Assign output
    always_comb begin
    M_prime =
     {M,ctx,8'($bits(ctx) / 8),8'd0};
//     27672'hFFCB5B1267B32866626139C37A5CC724B1C7B67ABB44F50D7384B1774BEF8D44175BED314BBE63EF382A968EB888B640C4FE90955B8AFFBBD54D9EE302B11A73D4F5AC1F6E96D8F263C64190AD6754EBCD70B24C5FF7E98C5C325CFE1F80EC870F23B9C3DC97D12D269D3194496E0D6DF9B31592FECD14DC0B1FC23B3ADAD3E3D9B9808AAD900E369E8526C1C55443ED25EE056B6A5A89410FDDB7BCD496F34BCA4EBA8FED82BF68A5DFF378A75216B7DCD5164BD467787E2F3E7BD0D852610891DAF77799B3FFA22E9DC68A67109ABCC600E0FF80A77662D53C60AF07EF8F527DEAE7CC5A9F1D28D5731C37A1EE171EA4BE09D8716288E96395A15D53509A3F0D730C7C29CD6227E2B8290C8A3FC1E724410A49E5B6E11B62FD69C5FDBFD485D8DD292DE19AF5D65BE2F5B9397B5F24D3BA381245515A5692F11A2C649C2A22E3A333AD1594068A4C33ED03C127E2E69E44F14287C23F8782D39AEF7FC872BFB7D2D59547B10F3FB4AEC5116357956A0F348E1FAAE79B2164AC2B42F9160A83C12E4BEE514C9EED35B28ED8FC2D232A3D30E04B3A5214D037B4309B85CC469DA34250350CA718C295A0EAF858C32436880005C835BF486F1A7AB69C1C0367686BF135BADDEE1E95171EB599671B777490F91285C77D67E3F9E11B91F07BA69139818D678D6A599AE16FB11709AF07FE02420C22F0E2A0ED8951C0FCD38DA49B772460E68E10E626A078A358CC4FDA4AD91C8EAD6F84A057E19FDD3CA95DC754CA15A0E54E2170F25CE681783E482039777622B6FFF72CF3830905EE32A97C42B14F8DB7AFF4FBB8AB9C5188022818987EA4C5323A1055D3E9AD62451C82BFB2693EC7EFBA698A827A6A0A63A5A3F05BF06C6F8EE44A07A0FABACD0292B69C29DC9E1FC36029DE151942B8D006F22D45BC0754B01331CD1F3627F4009B88F0C3CDE18606832CFAC78D5974A291369A088C88458B62EC16ABD1008C3934DE799152F403246B27C18F0C8C22B9BC2B8DFF8CEC7413426461E1CADB35839FC193AFE0E34F9D33759C65C6B57ED6C95DEEA5728CAD4769654FED93225A8FF13EF04BF872D8D9DBF0CC16500F4D8CE58A176DEC8F1113144C457A94620A111B0C7387C533DD578415CA82C096F65A18C207080AECA3612CDD37AC2D5E4579E6BAFB439BC5C7B2ADC0E9D6C58F527D55EA62D15A01062F69125BE8FC302926D0519C059AB3BF52FA555B4A03CC9C9D8AB95742FB731EE4B3CCDA896ADFB67C96C20674F34CE3A22B10D704A5BC2B9C75BD5D42D9E72A5D32B752CED836E81B9FDEB440C628AA3DD6B517EB9B1A3EF7A03D13AC8173A3AF98A8413BFA14C9F528BB65C607EBD64D13206C24D03FC218785A2E9A223B9A2B3B05A81EE66E43C1EB22C3DFB478EFB467C59860077FDE58E629C39FE62ED2EC213A8B0243B867A4DCAB38AD7CE263006B79335DA23924BC264F37BCABA3DABC4FD6BE7AECEC71AE5EF4845C4630DB03C6C3346DFB7549E715CFDCF380AAF939D07C5EA623E8137E0884FEAEB5C875F57433F6E86F6DC1DA8CD6641D107D2EB3FA4B8BCAD235DFDDAFB56576769B324D59E67F4CB411C963BB83194D83F66D8B564BB36A3CAB223E531838B9084A64F1A317C329FDE1FEE981280F4E1B9259B948D91F2AE7C811AEC441F99CD8105B701F28A96C32438D754DCAE8139BD422C1BE7F712E2A3909DB051565BCE8611071CD9E2EF3E8ED86044BA9DC1DDFFD12F01E37DE589E2C45E61FCE661DDED18DECB97746FDA52FD8D1F96CE2805CECFB0802759DB083B8D2A05848D31A866926791CF06367B7154AEE5E0D5F324AC48933D25E1B6834DD6801A5A5A45C5CBE4A8F4668646B889350EC2AAE517658A05693BEA048284EBD453F8862C21171EE92A0C2CFEBE2601DAA3E0D2E3D858BF2A8054F109DBB762241892225E326D13F7B3C1CB0B388B47433A1F5091A1F7FC0B395B9BDC26050D72AA08E62BF3B39846DCEB30169DA3F2050DBDCFCC56C07220962714E6C137C1AEC448612FA52B4F867719C4B6C7E56D855996DE7845311BD996B595CC9EB175952981424542D25FD26E49553D0BBB58A0B99F8D3A595969833C8798EF9582F7C5943F9D4693284287470C19FBDBDEDDDB6CE502FF244B3BC027CF18BB49603CDB519FA8DC1E120D915D05F35D4F6DB75DB9BD82A07FF89158F3DD1ED40F874DD6CF3EAA4C3601CD5AE761A22E57DE80BA07CB018BED9C6B58FE4FD840F32981C5B81C9E00C36B17A7F037C90E5672F1154C64CC4485B1E932D3414DF6297C57BDEFDC664B407FE6ACB3599BB5D35D028B5EB3049E5D4D4FF6236B3D722D217E83D00B2E7A1CB5C4CC7E2F913C26335F763EB2977677C960A29C6017E542647F91DB17D5D82E887E98FE38102DAC03CFE00BB7436A8A080C069A8BEDACADEF8A09B00F611E5D8757A6440E783FB932F6889027E98B210507C30BCF3DA2AAC1FB0EBE067DACA2B192746F9D268B8FDC5D5795650C75F60ED8BAF79E128E49A50B72037981A2C549D5EE95651B93EE8C332F61D60D45C57518BF2DC2B5149F042ACA81A478165ABA925B8F2DE090E344DC6B6AE32C6397B5BC8E50D2750284C14F913A51023A041CC4B743B1B6979477CBE8F659A9ABE7B722DBF7F9B588458FC6CDDE5F56923292574E1E652FE5FF24E9E9068C1C3B1793B9733E36321A574C61B3FAF8B9452129B653F25B8D72973CDCD30FDC71B9739BA64AA5D363FC503CF6D1F36BFAF66BA4B7ECD5C838BC0636EBF1696F0A7ACAB8405F527E9F4DB5B9F3B564BB7F2B41D6675B2494D3BB62EA346EF77292F1327C074B2B9BA3FD056A272BC473575AC7B0AF8307BF5635D484FC683A305643170282E8A423FFB6227A45BA6DA7E6FF92E99736C31FE97325C166A69F4BB2D513D414C1E06EA693C0E9508D69ABD82CAE0CC550991F7007191FC2D2CD5916E6B770968993250F24330375E9BF5C1979F939F89276623C04641DA8D0ABD3D667C279D5E9054E9988FD911D95A99647BCF648D98350846045449225757C3E886F2D0E1735863074BAA07FA4D554966ACDC5FBDA52FA43074E1990A47329140CBF18AE689B7F1236C5D42EE2E0DF8AF0AE2757BF80643574E9F6C92BF59BF1818C62E5CCA63DCF4EB3B5147ECB50266E8E9FF65BC1648C5AD3398E94B5F64139E2AD667DF9CE4A705808FBCB4FB6B999C06A9D5595A5C027E69AE97CAF3A98CD73EA9C2DF9B874B05585F3B868C10B2C8FE4C45B58FB944CED4E976ED4DDC12D703E47651A9BA017E5DCF01FA207BF158FCCFCBA664D7488465F30AB2115EB87B4D6482A799601E444BC657BFB849AE58F71DF17D106B722C9CF2ECB5AF4E6DFF1785ADBBF94ABE9BB0875A9E7F89CC1C45B2BBF36C3A6AE1F2560BA7746995FC5857A8329BF25FAC5F55CD8911D4AC1325CF6FFC937A92DC1BCCC8A23F162746F15E4527E19A8052530E94176CE1CF1DA9F882A4F99869DEC5CB17CF29BC6D482E8697B38F84328B4F1CA984E67B7039FCABF94794824D59F566621583B02896A14BE9E6491C8E24C5F755DDEEE4F8495BDDD37EC225B4AB393EBD28221C079EF312E39A9189EFDF1CD4819D2D706A116E18BAA5DDAAD37B973DAC0B5F6502A9EFB6E9DC005DB7D1EDF361EEA4177EC9D4ACBA096161C0493F670354DCE480B7D2D7AD76868E101160E9B8EA48E5D780BEE336B2ABF9488DF69F9D985A63F40873AA1BCC690842469CA8A877A9D60159908295F9ADCE0BD98E207FE7F078B7FDF5AF779DCA0A17B5A1F0150251D1E4209E4307D7CDFA5BA49F423D49885B5524F1AA82F95E638E866BE058BCB80887BD3C5F48AD70E030FA54D2FE87CCCE2C469BF111A64EEAC13BB5816BEDA29EEC96BA7F0C2912A8B3117A87A58C6406B99DB31221C6F7E16F519E0DF8EE744258B5E668CD4CC10333F33DFF2CC74434D6AEC7CD3A907D259ED910BB8A05B0C59C372FEFA6FC396DDCAFDE2D88F8B4A70D69364927A708C738C0C9F33B06792E437862F497548EDA745AF08AB14F9CA62469AD20CE669DF52F67B6E5324531D636B0EA1095C00FB8DB5BD5CCB67D16E92423CED258585FDDDA6DC5309DA9A82E281A5401658C106459F5457390D03FB151CDC10E775F7DDE500C3528FADF1A31B2A6A49B28148397126A796312EB4C092E13DFD0E79AB7C99C76B05856E8697ADA13C0E92CA3883C4929FB0CE61ACB64C02BFAE7FF4A4918EFDBFFB2642B402A00FE88FF2A63DD8A8AA286BE9EAAE381AB4B982BEE827A90C9A8FA51A4D6D81EE9D10CE792CC395D4E6F5D5CC38B7944F77D071893153B7E84F83582688BE6B3CA68D5CD9EFCEFDE113BDC7E251DCC3D2FB55926CFBF8BD3958E629A96B7F4C289A9925BB6ABA6FB8D28065739BD59672BF752B332BFE40ADC01370F995547594619F57C8B7087830E5E98A6B9339AD835FB6E9F654190C9C4877EB473966138E0AC101FC7DDDCBA70CEA4D3263D51A9675FDA9EE6A8F405892BB703F1D21077FC60C60C227B10EF4F61C539431EBF5BA1C912F40AAC18C2719EB8E9F26E07DA503947E684FAE7AD21DECC243682F5EFCFF7761B613D3B3E7915FE462326FDE059EAE809D6D8D7A7E265D22CE0F48BEEA8C919FAF7EC7812FE096D6EFBA08AFBE0EBCA4C9AEC18F620CF38FC6B0F5E858A0F9D5A0C02E86D72D50BCD6B69AB41DBD74BF4293F54BCB022DA28B37BA7EFABE7E4EB022FEFDD025DD9C4E14B8BB624F62193C36A5B4ABBE1A9E927C0B9F62E1B218384BF3FABE86DF1CC658FDB65972304BD5A132C418B9A30218605B642A3E395C529073264B775AB55788FE42B05435204BCFC9B1AEFE0F7EA8F1D25E2B7AE2882FA163C8FF19F05E568D6C8FCB5041B42B3FE00;
                   
    //{8'd0,($bits(ctx) / 8),ctx,M};//  // {0 , ($bits(ctx) / 8), ctx , M};
      $display("Hex value M_prime = %h", M_prime);
      if (rst) begin
        done = 0;
        end else begin
        if (ctx_len > 255) begin
            valid = 0;
                    done = 1;
        end else begin
            valid = internal_verify_valid;
            done = internal_done;
        end
        end
    end

endmodule
